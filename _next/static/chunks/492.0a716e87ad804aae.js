"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[492],{5492:function(e,t,r){r.r(t),r.d(t,{default:function(){return S}});var s=r(4924),o=r(5893),n=r(7294),a=r(5697),i=r.n(a),l=r(6134),u=r(1339),c=r(5524),p=r(13),h=r(6240),g=r(6396),d=r(5087),m=r.n(d);let f=(0,u.j)({theme:"dark",settings:{background:"var(--color-front)",foreground:"var(--color-subtle-on-dark)",caret:"var(--color-theme-dark)",selection:"var(--color-theme-dark)",selectionMatch:"var(--color-theme-dark)",gutterBackground:"var(--color-front)",gutterForeground:"var(--color-subtle-on-dark)",fontFamily:"var(--font-code)"},styles:[{tag:c.pJ.comment,color:"var(--syntax-comment)"},{tag:c.pJ.variableName,color:"var(--color-subtle-on-dark)"},{tag:[c.pJ.string,c.pJ.special(c.pJ.brace)],color:"#fff"},{tag:c.pJ.number,color:"var(--syntax-number)"},{tag:c.pJ.string,color:"var(--syntax-selector)"},{tag:c.pJ.bool,color:"var(--syntax-keyword)"},{tag:c.pJ.keyword,color:"var(--syntax-keyword)"},{tag:c.pJ.operator,color:"var(--syntax-operator)"}]});class S extends n.Component{log(e){this.props.debug&&e()}requestBinder(e,t,r){let s="".concat(r,"/build/gh/").concat(e,"/").concat(t);return this.log(()=>console.info("building",{binderUrl:s})),new Promise((e,t)=>{let r=new EventSource(s);r.onerror=e=>{r.close(),this.log(()=>console.error("failed",e)),t(Error(e))};let o=null;r.onmessage=s=>{let{data:n}=s,a=JSON.parse(n);if(a.phase&&a.phase!==o&&(o=a.phase.toLowerCase(),this.log(()=>console.info("ready"===o?"server-ready":o))),"failed"===a.phase)r.close(),t(Error(a));else if("ready"===a.phase){r.close();let i={baseUrl:a.url,wsUrl:"ws".concat(a.url.slice(4)),token:a.token};e(i)}}})}requestKernel(e){if(this.props.useStorage){let t=new Date().getTime()+6e4*this.props.storageExpire,r=JSON.stringify({settings:e,timestamp:t});g.u9.localStorage.setItem(this.props.storageKey,r)}let s=h.ServerConnection.makeSettings(e);return h.Kernel.startNew({type:this.props.kernelType,serverSettings:s}).then(e=>(this.log(()=>console.info("ready")),e))}getKernel(){if(this.props.useStorage){let e=g.u9.localStorage.getItem(this.props.storageKey);if(e){this.setState({fromStorage:!0});let{settings:t,timestamp:r}=JSON.parse(e);if(r&&new Date().getTime()<r)return this.requestKernel(t);g.u9.localStorage.removeItem(this.props.storageKey)}}return this.props.useBinder?this.requestBinder(this.props.repo,this.props.branch,this.props.url).then(e=>this.requestKernel(e)):this.requestKernel(this.props.serverSettings)}async renderResponse(e){if(null===this.state.code||""===this.state.code){this.state.output="No code entered";return}let t=e.requestExecute({code:this.state.code});this.state.output=this.props.msgLoading,t.handleMsg=e=>{e.content&&"stdout"===e.content.name&&this.setState({output:e.content.text})}}runCode(){if(this.log(()=>console.info("executing")),this.state.kernel){if(this.props.isolateCells){this.state.kernel.restart().then(()=>this.renderResponse(this.state.kernel)).catch(e=>{this.log(()=>console.error("faileder",e)),this.setState({kernel:null}),this.setState({output:this.props.msgError})});return}this.renderResponse(this.state.kernel);return}this.log(()=>console.info("requesting kernel"));let e=this.props.url.split("//")[1],t=this.state.fromStorage?"Reconnecting to":"Launching";this.setState({output:"".concat(t," Docker container on ").concat(e,"...")}),this.getKernel().then(e=>{this.setState({kernel:e}),this.renderResponse(e)}).catch(e=>{this.log(()=>console.error("failed",e)),this.setState({kernel:null}),this.props.useStorage&&(this.setState({fromStorage:!1}),g.u9.localStorage.removeItem(this.props.storageKey)),this.setState({output:this.props.msgError})})}render(){return(0,o.jsxs)("div",{className:this.props.classNames.cell,children:[this.state.code&&(0,o.jsx)(l.ZP,{value:this.state.code,extensions:[(0,p.Vs)()],theme:f,basicSetup:{lineNumbers:!1,foldGutter:!1,highlightActiveLine:!1,highlightSelectionMatches:!1},className:m()["juniper-input"],onChange:e=>{this.setState({code:e})}}),(0,o.jsx)("button",{className:this.props.classNames.button,onClick:()=>this.runCode(),children:this.props.msgButton}),null!==this.state.output&&(0,o.jsx)("pre",{className:"".concat(this.props.classNames.output," ").concat(m()["juniper-input"]," ").concat(m().wrap),children:this.state.output})]})}constructor(...e){super(...e),(0,s.Z)(this,"state",{kernel:null,renderers:null,fromStorage:null,output:null,code:this.props.children})}}S.defaultProps={children:"",branch:"master",url:"https://mybinder.org",serverSettings:{},kernelType:"python3",lang:"python",theme:"default",isolateCells:!0,useBinder:!0,storageKey:"juniper",useStorage:!0,storageExpire:60,debug:!1,msgButton:"run",msgLoading:"Loading...",msgError:"Connecting failed. Please reload and try again.",classNames:{cell:"juniper-cell",input:"juniper-input",button:"juniper-button",output:"juniper-output"}},S.propTypes={children:i().string,repo:i().string.isRequired,branch:i().string,url:i().string,serverSettings:i().object,kernelType:i().string,lang:i().string,theme:i().string,isolateCells:i().bool,useBinder:i().bool,useStorage:i().bool,storageExpire:i().number,msgButton:i().string,msgLoading:i().string,msgError:i().string,classNames:i().shape({cell:i().string,input:i().string,button:i().string,output:i().string})}}}]);