<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="shortcut icon" href="/icons/icon-192x192.png"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1, maximum-scale=5.0, shrink-to-fit=no, viewport-fit=cover"/><meta name="theme-color" content="#09a3d5"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png"/><title>Transformer · spaCy API Documentation</title><meta name="description" content="Pipeline component for multi-task learning with transformer models"/><meta property="og:title" content="Transformer · spaCy API Documentation"/><meta property="og:description" content="Pipeline component for multi-task learning with transformer models"/><meta property="og:type" content="website"/><meta property="og:site_name" content="Transformer"/><meta property="og:image" content="[object Object]"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:image" content="[object Object]"/><meta name="twitter:creator" content="@spacy_io"/><meta name="twitter:site" content="@spacy_io"/><meta name="twitter:title" content="Transformer · spaCy API Documentation"/><meta name="twitter:description" content="Pipeline component for multi-task learning with transformer models"/><meta name="docsearch:language" content="en"/><meta name="next-head-count" content="24"/><link rel="preload" href="/_next/static/css/8f0b94edbc18d62d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/8f0b94edbc18d62d.css" data-n-g=""/><link rel="preload" href="/_next/static/css/e6995e0e8addcf99.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e6995e0e8addcf99.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script defer="" src="/_next/static/chunks/262.c647d33d06232ef6.js"></script><script defer="" src="/_next/static/chunks/728.cf6ba0da2700fa1b.js"></script><script src="/_next/static/chunks/webpack-8161fc2bb14cec39.js" defer=""></script><script src="/_next/static/chunks/framework-3b5a00d5d7e8d93b.js" defer=""></script><script src="/_next/static/chunks/main-a0f603ce323043fd.js" defer=""></script><script src="/_next/static/chunks/pages/_app-ee1fab0e25bb912e.js" defer=""></script><script src="/_next/static/chunks/94-57434c8b7a6c3878.js" defer=""></script><script src="/_next/static/chunks/128-76b45627a109219b.js" defer=""></script><script src="/_next/static/chunks/pages/%5B...listPathPage%5D-45eea57fe8c2902c.js" defer=""></script><script src="/_next/static/2lY2cUyEfZosk4VLgkHb2/_buildManifest.js" defer=""></script><script src="/_next/static/2lY2cUyEfZosk4VLgkHb2/_ssgManifest.js" defer=""></script></head><body class="theme-blue"><div id="__next"><div class="theme-green"><nav class="navigation_root__yPL8O"><span class="navigation_has-alert__s0Drf"><a class="link_root__1Me7D link_no-link-layout__RPvod" aria-label="spaCy" href="/"><h1 class="navigation_title__pm49s">spaCy</h1></a> <span class="navigation_alert__ZOXon"><a class="link_root__1Me7D link_no-link-layout__RPvod" href="/usage/v3-5"><strong>💥 Out now:</strong> spaCy v3.5</a></span></span><div class="navigation_menu__ZMJxN"><select class="dropdown_root__3uiQq navigation_dropdown__4j4pI"><option value="title" disabled="">Menu</option><option value="/usage">Usage</option><option value="/models">Models</option><option value="/api" selected="">API</option><option value="/universe">Universe</option></select><ul class="navigation_list__DCzqi"><li class="navigation_item__ln1O1"><a class="link_root__1Me7D link_no-link-layout__RPvod" href="/usage">Usage</a></li><li class="navigation_item__ln1O1"><a class="link_root__1Me7D link_no-link-layout__RPvod" href="/models">Models</a></li><li class="navigation_item__ln1O1 navigation_is-active__RjVJG"><a class="link_root__1Me7D link_no-link-layout__RPvod" tabindex="-1" href="/api">API</a></li><li class="navigation_item__ln1O1"><a class="link_root__1Me7D link_no-link-layout__RPvod" href="/universe">Universe</a></li><li class="navigation_item__ln1O1 navigation_github__MpFNv"><span><a href="https://github.com/explosion/spaCy" data-size="large" data-show-count="true" aria-label="Star spaCy on GitHub"></a></span></li></ul><div class="navigation_search__BKZCn"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div><progress class="progress_root__9huWN" value="0" max="100"></progress></nav><menu class="sidebar sidebar_root__s2No7"><h1 hidden="" aria-hidden="true" class="h0 sidebar_active-heading___dkf9">Pipeline</h1><div class="sidebar_dropdown__vyqjz"><select class="dropdown_root__3uiQq sidebar_dropdown-select__Nwbq9"><option disabled="">Select page...</option><option value="/api">Overview<!-- --> › <!-- -->Library Architecture</option><option value="/api/architectures">Overview<!-- --> › <!-- -->Model Architectures</option><option value="/api/data-formats">Overview<!-- --> › <!-- -->Data Formats</option><option value="/api/cli">Overview<!-- --> › <!-- -->Command Line</option><option value="/api/top-level">Overview<!-- --> › <!-- -->Functions</option><option value="/api/doc">Containers<!-- --> › <!-- -->Doc</option><option value="/api/docbin">Containers<!-- --> › <!-- -->DocBin</option><option value="/api/example">Containers<!-- --> › <!-- -->Example</option><option value="/api/language">Containers<!-- --> › <!-- -->Language</option><option value="/api/lexeme">Containers<!-- --> › <!-- -->Lexeme</option><option value="/api/span">Containers<!-- --> › <!-- -->Span</option><option value="/api/spangroup">Containers<!-- --> › <!-- -->SpanGroup</option><option value="/api/token">Containers<!-- --> › <!-- -->Token</option><option value="/api/attributeruler">Pipeline<!-- --> › <!-- -->AttributeRuler</option><option value="/api/coref">Pipeline<!-- --> › <!-- -->CoreferenceResolver</option><option value="/api/dependencyparser">Pipeline<!-- --> › <!-- -->DependencyParser</option><option value="/api/edittreelemmatizer">Pipeline<!-- --> › <!-- -->EditTreeLemmatizer</option><option value="/api/entitylinker">Pipeline<!-- --> › <!-- -->EntityLinker</option><option value="/api/entityrecognizer">Pipeline<!-- --> › <!-- -->EntityRecognizer</option><option value="/api/entityruler">Pipeline<!-- --> › <!-- -->EntityRuler</option><option value="/api/lemmatizer">Pipeline<!-- --> › <!-- -->Lemmatizer</option><option value="/api/morphologizer">Pipeline<!-- --> › <!-- -->Morphologizer</option><option value="/api/sentencerecognizer">Pipeline<!-- --> › <!-- -->SentenceRecognizer</option><option value="/api/sentencizer">Pipeline<!-- --> › <!-- -->Sentencizer</option><option value="/api/spancategorizer">Pipeline<!-- --> › <!-- -->SpanCategorizer</option><option value="/api/span-resolver">Pipeline<!-- --> › <!-- -->SpanResolver</option><option value="/api/spanruler">Pipeline<!-- --> › <!-- -->SpanRuler</option><option value="/api/tagger">Pipeline<!-- --> › <!-- -->Tagger</option><option value="/api/textcategorizer">Pipeline<!-- --> › <!-- -->TextCategorizer</option><option value="/api/tok2vec">Pipeline<!-- --> › <!-- -->Tok2Vec</option><option value="/api/tokenizer">Pipeline<!-- --> › <!-- -->Tokenizer</option><option value="/api/pipe">Pipeline<!-- --> › <!-- -->TrainablePipe</option><option value="/api/transformer" selected="">Pipeline<!-- --> › <!-- -->Transformer</option><option value="/api/pipeline-functions">Pipeline<!-- --> › <!-- -->Other Functions</option><option value="/api/dependencymatcher">Matchers<!-- --> › <!-- -->DependencyMatcher</option><option value="/api/matcher">Matchers<!-- --> › <!-- -->Matcher</option><option value="/api/phrasematcher">Matchers<!-- --> › <!-- -->PhraseMatcher</option><option value="/api/attributes">Other<!-- --> › <!-- -->Attributes</option><option value="/api/corpus">Other<!-- --> › <!-- -->Corpus</option><option value="/api/inmemorylookupkb">Other<!-- --> › <!-- -->InMemoryLookupKB</option><option value="/api/kb">Other<!-- --> › <!-- -->KnowledgeBase</option><option value="/api/lookups">Other<!-- --> › <!-- -->Lookups</option><option value="/api/morphology#morphanalysis">Other<!-- --> › <!-- -->MorphAnalysis</option><option value="/api/morphology">Other<!-- --> › <!-- -->Morphology</option><option value="/api/scorer">Other<!-- --> › <!-- -->Scorer</option><option value="/api/stringstore">Other<!-- --> › <!-- -->StringStore</option><option value="/api/vectors">Other<!-- --> › <!-- -->Vectors</option><option value="/api/vocab">Other<!-- --> › <!-- -->Vocab</option><option value="/api/cython">Cython<!-- --> › <!-- -->Architecture</option><option value="/api/cython-classes">Cython<!-- --> › <!-- -->Classes</option><option value="/api/cython-structs">Cython<!-- --> › <!-- -->Structs</option><option value="/api/legacy">Legacy<!-- --> › <!-- -->Legacy functions</option></select></div><ul class="sidebar_section__DArOO"><li class="sidebar_label__V3K28">Overview</li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api">Library Architecture</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/architectures">Model Architectures</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/data-formats">Data Formats</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/cli">Command Line</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/top-level">Functions</a></li></ul><ul class="sidebar_section__DArOO"><li class="sidebar_label__V3K28">Containers</li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/doc">Doc</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/docbin">DocBin</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/example">Example</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/language">Language</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/lexeme">Lexeme</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/span">Span</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/spangroup">SpanGroup</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/token">Token</a></li></ul><ul class="sidebar_section__DArOO"><li class="sidebar_label__V3K28">Pipeline</li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/attributeruler">AttributeRuler</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/coref">CoreferenceResolver</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/dependencyparser">DependencyParser</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/edittreelemmatizer">EditTreeLemmatizer</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/entitylinker">EntityLinker</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/entityrecognizer">EntityRecognizer</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/entityruler">EntityRuler</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/lemmatizer">Lemmatizer</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/morphologizer">Morphologizer</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/sentencerecognizer">SentenceRecognizer</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/sentencizer">Sentencizer</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/spancategorizer">SpanCategorizer</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/span-resolver">SpanResolver</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/spanruler">SpanRuler</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/tagger">Tagger</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/textcategorizer">TextCategorizer</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/tok2vec">Tok2Vec</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/tokenizer">Tokenizer</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/pipe">TrainablePipe</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP sidebar_is-active__yVTtL is-active" href="/api/transformer">Transformer</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/pipeline-functions">Other Functions</a></li></ul><ul class="sidebar_section__DArOO"><li class="sidebar_label__V3K28">Matchers</li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/dependencymatcher">DependencyMatcher</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/matcher">Matcher</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/phrasematcher">PhraseMatcher</a></li></ul><ul class="sidebar_section__DArOO"><li class="sidebar_label__V3K28">Other</li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/attributes">Attributes</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/corpus">Corpus</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/inmemorylookupkb">InMemoryLookupKB</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/kb">KnowledgeBase</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/lookups">Lookups</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/morphology#morphanalysis">MorphAnalysis</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/morphology">Morphology</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/scorer">Scorer</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/stringstore">StringStore</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/vectors">Vectors</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/vocab">Vocab</a></li></ul><ul class="sidebar_section__DArOO"><li class="sidebar_label__V3K28">Cython</li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/cython">Architecture</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/cython-classes">Classes</a></li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/cython-structs">Structs</a></li></ul><ul class="sidebar_section__DArOO"><li class="sidebar_label__V3K28">Legacy</li><li><a class="link_root__1Me7D sidebar_link__sKXFP" href="/api/legacy">Legacy functions</a></li></ul></menu><main class="main_root__7f6Tj main_with-sidebar__uH1df main_with-asides__ikQT6"><article class="main_content__8zFCH"><header class="title_root__pS2WQ"><div class="title_corner__S0Hac"><a class="link_root__1Me7D button_root__jwipc button_secondary__ukZAk" rel="noopener nofollow noreferrer" target="_blank" href="https://github.com/explosion/spacy-transformers/blob/master/spacy_transformers/pipeline_component.py">Source</a></div><h1 id="_title" class="typography_heading__D82WZ typography_h1__b7dt9 title_h1__l3CW1"><span class="heading-text">Transformer<!-- --> </span></h1><div class="title_tags__PljaK"><span class="tag_root__NTSnK tag_spaced__Q9amH">class</span><span class="tag_root__NTSnK tag_spaced__Q9amH" data-tooltip="This feature is new and was introduced in spaCy v3">v<!-- -->3</span></div><div class="typography_inline-list__B7N9X title_teaser__QhwCH"><span><span class="typography_label__l_oVJ title_label__r2BOW">String name<!-- -->:</span><code class="code_inline-code__Bq7ot">transformer</code></span></div><div class="heading-teaser title_teaser__QhwCH">Pipeline component for multi-task learning with transformer models</div></header><section class="section_root__k1hUl"><aside class="aside_root__667WA"><div class="aside_content__ZN6qm" role="complementary"><div class="aside_text__LFH_Q">
<h4 class="typography_heading__D82WZ typography_h4__CDRaM"><span class="heading-text">Installation<!-- --> </span></h4>
<pre class="code_pre__kzg60"><code class="code_code__CILJL language-bash language-bash"></code></pre>
</div></div></aside><aside class="infobox_root__yNIMg infobox_warning__SKl67"><h4 class="infobox_title__uDT7C"><span>Important note</span></h4><p>This component is available via the extension package
<a class="link_root__1Me7D link_nowrap__H7Oxl link_with-icon__NAVDA" rel="noopener nofollow noreferrer" target="_blank" href="https://github.com/explosion/spacy-transformers"><code class="code_inline-code__Bq7ot">spacy-transformers</code></a>. It
exposes the component via entry points, so if you have the package installed,
using <code class="code_inline-code__Bq7ot">factory = &quot;transformer&quot;</code> in your
<a class="link_root__1Me7D" href="/usage/training#config">training config</a> or <code class="code_inline-code__Bq7ot">nlp.add_pipe(&quot;transformer&quot;)</code> will
work out-of-the-box.</p></aside><p>This pipeline component lets you use transformer models in your pipeline. It
supports all models that are available via the
<a class="link_root__1Me7D" rel="noopener nofollow noreferrer" target="_blank" href="https://huggingface.co/transformers">HuggingFace <code class="code_inline-code__Bq7ot">transformers</code></a> library.
Usually you will connect subsequent components to the shared transformer using
the <a class="link_root__1Me7D link_nowrap__H7Oxl link_with-icon__NAVDA" href="/api/architectures#TransformerListener"><span class="link_source-text__VDP74">TransformerListener</span></a> layer. This
works similarly to spaCy’s <a class="link_root__1Me7D link_with-icon__NAVDA" href="/api/tok2vec"><span class="link_source-text__VDP74">Tok2Vec</span></a> component and
<a class="link_root__1Me7D link_with-icon__NAVDA" href="/api/architectures#Tok2VecListener"><span class="link_source-text__VDP74">Tok2VecListener</span></a> sublayer.</p><p>The component assigns the output of the transformer to the <code class="code_inline-code__Bq7ot">Doc</code>’s extension
attributes. We also calculate an alignment between the word-piece tokens and the
spaCy tokenization, so that we can use the last hidden states to set the
<code class="code_inline-code__Bq7ot">Doc.tensor</code> attribute. When multiple word-piece tokens align to the same spaCy
token, the spaCy token receives the sum of their values. To access the values,
you can use the custom <a class="link_root__1Me7D" href="/api/transformer#assigned-attributes"><code class="code_inline-code__Bq7ot">Doc._.trf_data</code></a> attribute. The
package also adds the function registries <a class="link_root__1Me7D" href="/api/transformer#span_getters"><code class="code_inline-code__Bq7ot">@span_getters</code></a> and
<a class="link_root__1Me7D" href="/api/transformer#annotation_setters"><code class="code_inline-code__Bq7ot">@annotation_setters</code></a> with several built-in registered
functions. For more details, see the
<a class="link_root__1Me7D" href="/usage/embeddings-transformers">usage documentation</a>.</p></section>
<section id="section-assigned-attributes" class="section_root__k1hUl"><h2 id="assigned-attributes" class="typography_heading__D82WZ typography_h2__hzV3h"><a href="#assigned-attributes" class="heading-text typography_permalink__UiIRy">Assigned Attributes <!-- --> </a></h2><p>The component sets the following
<a class="link_root__1Me7D" href="/usage/processing-pipeline#custom-components-attributes">custom extension attribute</a>:</p><table class="table_root__ZlA_w"><thead><tr class="table_tr__K_tkF"><th class="table_th__QJ9F8">Location</th><th class="table_th__QJ9F8">Value</th></tr></thead><tbody><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">Doc._.trf_data</code></td><td class="table_td__rmpJx">Transformer tokens and outputs for the <code class="code_inline-code__Bq7ot">Doc</code> object. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation"><a class="link_root__1Me7D" href="/api/transformer#transformerdata">TransformerData</a></span></td></tr></tbody></table></section>
<section id="section-config" class="section_root__k1hUl"><h2 id="config" class="typography_heading__D82WZ typography_h2__hzV3h"><a href="#config" class="heading-text typography_permalink__UiIRy">Config and implementation <!-- --> </a></h2><p>The default config is defined by the pipeline component factory and describes
how the component should be configured. You can override its settings via the
<code class="code_inline-code__Bq7ot">config</code> argument on <a class="link_root__1Me7D link_nowrap__H7Oxl link_with-icon__NAVDA" href="/api/language#add_pipe"><code class="code_inline-code__Bq7ot">nlp.add_pipe</code></a> or in your
<a class="link_root__1Me7D" href="/usage/training#config"><code class="code_inline-code__Bq7ot">config.cfg</code> for training</a>. See the
<a class="link_root__1Me7D link_nowrap__H7Oxl link_with-icon__NAVDA" href="/api/architectures#transformers"><span class="link_source-text__VDP74">model architectures</span></a> documentation for details
on the transformer architectures and their arguments and hyperparameters.</p><aside class="aside_root__667WA"><div class="aside_content__ZN6qm" role="complementary"><div class="aside_text__LFH_Q">
<h4 class="typography_heading__D82WZ typography_h4__CDRaM"><span class="heading-text">Example<!-- --> </span></h4>
<pre class="code_pre__kzg60"><code class="code_code__CILJL language-python language-python"></code></pre>
</div></div></aside><table class="table_root__ZlA_w"><thead><tr class="table_tr__K_tkF"><th class="table_th__QJ9F8">Setting</th><th class="table_th__QJ9F8">Description</th></tr></thead><tbody><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">max_batch_items</code></td><td class="table_td__rmpJx">Maximum size of a padded batch. Defaults to <code class="code_inline-code__Bq7ot">4096</code>. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation">int</span></td></tr><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">set_extra_annotations</code></td><td class="table_td__rmpJx">Function that takes a batch of <code class="code_inline-code__Bq7ot">Doc</code> objects and transformer outputs to set additional annotations on the <code class="code_inline-code__Bq7ot">Doc</code>. The <code class="code_inline-code__Bq7ot">Doc._.trf_data</code> attribute is set prior to calling the callback. Defaults to <code class="code_inline-code__Bq7ot">null_annotation_setter</code> (no additional annotations). <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM code_wrap__b41os" role="code" aria-label="Type annotation">Callable<span class="code_cli-arg-subtle__IgB5m">[</span><span class="code_cli-arg-subtle__IgB5m">[</span>List<span class="code_cli-arg-subtle__IgB5m">[</span><a class="link_root__1Me7D" href="/api/doc">Doc</a><span class="code_cli-arg-subtle__IgB5m">]</span><span class="code_cli-arg-subtle__IgB5m">,</span><a class="link_root__1Me7D" href="/api/transformer#fulltransformerbatch">FullTransformerBatch</a><span class="code_cli-arg-subtle__IgB5m">]</span><span class="code_cli-arg-subtle__IgB5m">,</span> None<span class="code_cli-arg-subtle__IgB5m">]</span></span></td></tr><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">model</code></td><td class="table_td__rmpJx">The Thinc <a class="link_root__1Me7D" rel="noopener nofollow noreferrer" target="_blank" href="https://thinc.ai/docs/api-model"><code class="code_inline-code__Bq7ot">Model</code></a> wrapping the transformer. Defaults to <a class="link_root__1Me7D link_nowrap__H7Oxl link_with-icon__NAVDA" href="/api/architectures#TransformerModel"><span class="link_source-text__VDP74">TransformerModel</span></a>. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM code_wrap__b41os" role="code" aria-label="Type annotation"><a class="link_root__1Me7D" rel="noopener nofollow noreferrer" target="_blank" href="https://thinc.ai/docs/api-model">Model</a><span class="code_cli-arg-subtle__IgB5m">[</span>List<span class="code_cli-arg-subtle__IgB5m">[</span><a class="link_root__1Me7D" href="/api/doc">Doc</a><span class="code_cli-arg-subtle__IgB5m">]</span><span class="code_cli-arg-subtle__IgB5m">,</span><a class="link_root__1Me7D" href="/api/transformer#fulltransformerbatch">FullTransformerBatch</a><span class="code_cli-arg-subtle__IgB5m">]</span></span></td></tr></tbody></table><pre class="code_pre__kzg60"><header class="code_header__Jc0Q1"><a class="link_root__1Me7D link_no-link-layout__RPvod" rel="noopener nofollow noreferrer" target="_blank" href="https://github.com/explosion/spacy-transformers/blob/master/spacy_transformers/pipeline_component.py"><code class="code_inline-code__Bq7ot code_inline-code-dark__ZEbch">explosion/spacy-transformers/master/spacy_transformers/pipeline_component.py</code></a></header><code class="code_code__CILJL code_code__CILJL code_max-height__093k6 code_code__CILJL language-python language-python code_max-height__093k6 language-python"></code></pre></section>
<section id="section-init" class="section_root__k1hUl"><h2 id="init" class="typography_heading__D82WZ typography_h2__hzV3h"><a href="#init" class="heading-text typography_permalink__UiIRy">Transformer.__init__ <!-- --> </a><span class="tag_root__NTSnK tag_spaced__Q9amH">method</span></h2><aside class="aside_root__667WA"><div class="aside_content__ZN6qm" role="complementary"><div class="aside_text__LFH_Q">
<h4 class="typography_heading__D82WZ typography_h4__CDRaM"><span class="heading-text">Example<!-- --> </span></h4>
<pre class="code_pre__kzg60"><code class="code_code__CILJL language-python language-python"></code></pre>
</div></div></aside><p>Construct a <code class="code_inline-code__Bq7ot">Transformer</code> component. One or more subsequent spaCy components can
use the transformer outputs as features in its model, with gradients
backpropagated to the single shared weights. The activations from the
transformer are saved in the <a class="link_root__1Me7D" href="/api/transformer#assigned-attributes"><code class="code_inline-code__Bq7ot">Doc._.trf_data</code></a> extension
attribute. You can also provide a callback to set additional annotations. In
your application, you would normally use a shortcut for this and instantiate the
component using its string name and <a class="link_root__1Me7D link_nowrap__H7Oxl link_with-icon__NAVDA" href="/api/language#create_pipe"><code class="code_inline-code__Bq7ot">nlp.add_pipe</code></a>.</p><table class="table_root__ZlA_w"><thead><tr class="table_tr__K_tkF"><th class="table_th__QJ9F8">Name</th><th class="table_th__QJ9F8">Description</th></tr></thead><tbody><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">vocab</code></td><td class="table_td__rmpJx">The shared vocabulary. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation"><a class="link_root__1Me7D" href="/api/vocab">Vocab</a></span></td></tr><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">model</code></td><td class="table_td__rmpJx">The Thinc <a class="link_root__1Me7D" rel="noopener nofollow noreferrer" target="_blank" href="https://thinc.ai/docs/api-model"><code class="code_inline-code__Bq7ot">Model</code></a> wrapping the transformer. Usually you will want to use the <a class="link_root__1Me7D link_nowrap__H7Oxl link_with-icon__NAVDA" href="/api/architectures#TransformerModel"><span class="link_source-text__VDP74">TransformerModel</span></a> layer for this. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM code_wrap__b41os" role="code" aria-label="Type annotation"><a class="link_root__1Me7D" rel="noopener nofollow noreferrer" target="_blank" href="https://thinc.ai/docs/api-model">Model</a><span class="code_cli-arg-subtle__IgB5m">[</span>List<span class="code_cli-arg-subtle__IgB5m">[</span><a class="link_root__1Me7D" href="/api/doc">Doc</a><span class="code_cli-arg-subtle__IgB5m">]</span><span class="code_cli-arg-subtle__IgB5m">,</span><a class="link_root__1Me7D" href="/api/transformer#fulltransformerbatch">FullTransformerBatch</a><span class="code_cli-arg-subtle__IgB5m">]</span></span></td></tr><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">set_extra_annotations</code></td><td class="table_td__rmpJx">Function that takes a batch of <code class="code_inline-code__Bq7ot">Doc</code> objects and transformer outputs and stores the annotations on the <code class="code_inline-code__Bq7ot">Doc</code>. The <code class="code_inline-code__Bq7ot">Doc._.trf_data</code> attribute is set prior to calling the callback. By default, no additional annotations are set. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM code_wrap__b41os" role="code" aria-label="Type annotation">Callable<span class="code_cli-arg-subtle__IgB5m">[</span><span class="code_cli-arg-subtle__IgB5m">[</span>List<span class="code_cli-arg-subtle__IgB5m">[</span><a class="link_root__1Me7D" href="/api/doc">Doc</a><span class="code_cli-arg-subtle__IgB5m">]</span><span class="code_cli-arg-subtle__IgB5m">,</span><a class="link_root__1Me7D" href="/api/transformer#fulltransformerbatch">FullTransformerBatch</a><span class="code_cli-arg-subtle__IgB5m">]</span><span class="code_cli-arg-subtle__IgB5m">,</span> None<span class="code_cli-arg-subtle__IgB5m">]</span></span></td></tr><tr class="table_tr__K_tkF table_divider__DRQHe"><td class="table_td__rmpJx"><em>keyword-only</em></td><td class="table_td__rmpJx"></td></tr><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">name</code></td><td class="table_td__rmpJx">String name of the component instance. Used to add entries to the <code class="code_inline-code__Bq7ot">losses</code> during training. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation">str</span></td></tr><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">max_batch_items</code></td><td class="table_td__rmpJx">Maximum size of a padded batch. Defaults to <code class="code_inline-code__Bq7ot">128*32</code>. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation">int</span></td></tr></tbody></table></section>
<section id="section-call" class="section_root__k1hUl"><h2 id="call" class="typography_heading__D82WZ typography_h2__hzV3h"><a href="#call" class="heading-text typography_permalink__UiIRy">Transformer.__call__ <!-- --> </a><span class="tag_root__NTSnK tag_spaced__Q9amH">method</span></h2><p>Apply the pipe to one document. The document is modified in place, and returned.
This usually happens under the hood when the <code class="code_inline-code__Bq7ot">nlp</code> object is called on a text
and all pipeline components are applied to the <code class="code_inline-code__Bq7ot">Doc</code> in order. Both
<a class="link_root__1Me7D link_nowrap__H7Oxl link_with-icon__NAVDA" href="/api/transformer#call"><code class="code_inline-code__Bq7ot">__call__</code></a> and <a class="link_root__1Me7D link_nowrap__H7Oxl link_with-icon__NAVDA" href="/api/transformer#pipe"><code class="code_inline-code__Bq7ot">pipe</code></a> delegate
to the <a class="link_root__1Me7D link_nowrap__H7Oxl link_with-icon__NAVDA" href="/api/transformer#predict"><code class="code_inline-code__Bq7ot">predict</code></a> and
<a class="link_root__1Me7D link_nowrap__H7Oxl link_with-icon__NAVDA" href="/api/transformer#set_annotations"><code class="code_inline-code__Bq7ot">set_annotations</code></a> methods.</p><aside class="aside_root__667WA"><div class="aside_content__ZN6qm" role="complementary"><div class="aside_text__LFH_Q">
<h4 class="typography_heading__D82WZ typography_h4__CDRaM"><span class="heading-text">Example<!-- --> </span></h4>
<pre class="code_pre__kzg60"><code class="code_code__CILJL language-python language-python"></code></pre>
</div></div></aside><table class="table_root__ZlA_w"><thead><tr class="table_tr__K_tkF"><th class="table_th__QJ9F8">Name</th><th class="table_th__QJ9F8">Description</th></tr></thead><tbody><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">doc</code></td><td class="table_td__rmpJx">The document to process. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation"><a class="link_root__1Me7D" href="/api/doc">Doc</a></span></td></tr><tr class="table_tr__K_tkF table_footer__gJRIy table-footer"><td class="table_td__rmpJx"><strong>RETURNS</strong></td><td class="table_td__rmpJx">The processed document. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation"><a class="link_root__1Me7D" href="/api/doc">Doc</a></span></td></tr></tbody></table></section>
<section id="section-pipe" class="section_root__k1hUl"><h2 id="pipe" class="typography_heading__D82WZ typography_h2__hzV3h"><a href="#pipe" class="heading-text typography_permalink__UiIRy">Transformer.pipe <!-- --> </a><span class="tag_root__NTSnK tag_spaced__Q9amH">method</span></h2><p>Apply the pipe to a stream of documents. This usually happens under the hood
when the <code class="code_inline-code__Bq7ot">nlp</code> object is called on a text and all pipeline components are
applied to the <code class="code_inline-code__Bq7ot">Doc</code> in order. Both <a class="link_root__1Me7D link_nowrap__H7Oxl link_with-icon__NAVDA" href="/api/transformer#call"><code class="code_inline-code__Bq7ot">__call__</code></a> and
<a class="link_root__1Me7D link_nowrap__H7Oxl link_with-icon__NAVDA" href="/api/transformer#pipe"><code class="code_inline-code__Bq7ot">pipe</code></a> delegate to the
<a class="link_root__1Me7D link_nowrap__H7Oxl link_with-icon__NAVDA" href="/api/transformer#predict"><code class="code_inline-code__Bq7ot">predict</code></a> and
<a class="link_root__1Me7D link_nowrap__H7Oxl link_with-icon__NAVDA" href="/api/transformer#set_annotations"><code class="code_inline-code__Bq7ot">set_annotations</code></a> methods.</p><aside class="aside_root__667WA"><div class="aside_content__ZN6qm" role="complementary"><div class="aside_text__LFH_Q">
<h4 class="typography_heading__D82WZ typography_h4__CDRaM"><span class="heading-text">Example<!-- --> </span></h4>
<pre class="code_pre__kzg60"><code class="code_code__CILJL language-python language-python"></code></pre>
</div></div></aside><table class="table_root__ZlA_w"><thead><tr class="table_tr__K_tkF"><th class="table_th__QJ9F8">Name</th><th class="table_th__QJ9F8">Description</th></tr></thead><tbody><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">stream</code></td><td class="table_td__rmpJx">A stream of documents. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation">Iterable<span class="code_cli-arg-subtle__IgB5m">[</span><a class="link_root__1Me7D" href="/api/doc">Doc</a><span class="code_cli-arg-subtle__IgB5m">]</span></span></td></tr><tr class="table_tr__K_tkF table_divider__DRQHe"><td class="table_td__rmpJx"><em>keyword-only</em></td><td class="table_td__rmpJx"></td></tr><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">batch_size</code></td><td class="table_td__rmpJx">The number of documents to buffer. Defaults to <code class="code_inline-code__Bq7ot">128</code>. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation">int</span></td></tr><tr class="table_tr__K_tkF table_footer__gJRIy table-footer"><td class="table_td__rmpJx"><strong>YIELDS</strong></td><td class="table_td__rmpJx">The processed documents in order. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation"><a class="link_root__1Me7D" href="/api/doc">Doc</a></span></td></tr></tbody></table></section>
<section id="section-initialize" class="section_root__k1hUl"><h2 id="initialize" class="typography_heading__D82WZ typography_h2__hzV3h"><a href="#initialize" class="heading-text typography_permalink__UiIRy">Transformer.initialize <!-- --> </a><span class="tag_root__NTSnK tag_spaced__Q9amH">method</span></h2><p>Initialize the component for training and return an
<a class="link_root__1Me7D" rel="noopener nofollow noreferrer" target="_blank" href="https://thinc.ai/docs/api-optimizers"><code class="code_inline-code__Bq7ot">Optimizer</code></a>. <code class="code_inline-code__Bq7ot">get_examples</code> should be a
function that returns an iterable of <a class="link_root__1Me7D link_nowrap__H7Oxl link_with-icon__NAVDA" href="/api/example"><code class="code_inline-code__Bq7ot">Example</code></a> objects. <strong>At
least one example should be supplied.</strong> The data examples are used to
<strong>initialize the model</strong> of the component and can either be the full training
data or a representative sample. Initialization includes validating the network,
<a class="link_root__1Me7D" rel="noopener nofollow noreferrer" target="_blank" href="https://thinc.ai/docs/usage-models#validation">inferring missing shapes</a> and
setting up the label scheme based on the data. This method is typically called
by <a class="link_root__1Me7D link_nowrap__H7Oxl link_with-icon__NAVDA" href="/api/language#initialize"><code class="code_inline-code__Bq7ot">Language.initialize</code></a>.</p><aside class="aside_root__667WA"><div class="aside_content__ZN6qm" role="complementary"><div class="aside_text__LFH_Q">
<h4 class="typography_heading__D82WZ typography_h4__CDRaM"><span class="heading-text">Example<!-- --> </span></h4>
<pre class="code_pre__kzg60"><code class="code_code__CILJL language-python language-python"></code></pre>
</div></div></aside><table class="table_root__ZlA_w"><thead><tr class="table_tr__K_tkF"><th class="table_th__QJ9F8">Name</th><th class="table_th__QJ9F8">Description</th></tr></thead><tbody><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">get_examples</code></td><td class="table_td__rmpJx">Function that returns gold-standard annotations in the form of <a class="link_root__1Me7D link_nowrap__H7Oxl link_with-icon__NAVDA" href="/api/example"><code class="code_inline-code__Bq7ot">Example</code></a> objects. Must contain at least one <code class="code_inline-code__Bq7ot">Example</code>. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM code_wrap__b41os" role="code" aria-label="Type annotation">Callable<span class="code_cli-arg-subtle__IgB5m">[</span><span class="code_cli-arg-subtle__IgB5m">[</span><span class="code_cli-arg-subtle__IgB5m">]</span><span class="code_cli-arg-subtle__IgB5m">,</span> Iterable<span class="code_cli-arg-subtle__IgB5m">[</span><a class="link_root__1Me7D" href="/api/example">Example</a><span class="code_cli-arg-subtle__IgB5m">]</span><span class="code_cli-arg-subtle__IgB5m">]</span></span></td></tr><tr class="table_tr__K_tkF table_divider__DRQHe"><td class="table_td__rmpJx"><em>keyword-only</em></td><td class="table_td__rmpJx"></td></tr><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">nlp</code></td><td class="table_td__rmpJx">The current <code class="code_inline-code__Bq7ot">nlp</code> object. Defaults to <code class="code_inline-code__Bq7ot">None</code>. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation">Optional<span class="code_cli-arg-subtle__IgB5m">[</span><a class="link_root__1Me7D" href="/api/language">Language</a><span class="code_cli-arg-subtle__IgB5m">]</span></span></td></tr></tbody></table></section>
<section id="section-predict" class="section_root__k1hUl"><h2 id="predict" class="typography_heading__D82WZ typography_h2__hzV3h"><a href="#predict" class="heading-text typography_permalink__UiIRy">Transformer.predict <!-- --> </a><span class="tag_root__NTSnK tag_spaced__Q9amH">method</span></h2><p>Apply the component’s model to a batch of <a class="link_root__1Me7D link_nowrap__H7Oxl link_with-icon__NAVDA" href="/api/doc"><code class="code_inline-code__Bq7ot">Doc</code></a> objects without
modifying them.</p><aside class="aside_root__667WA"><div class="aside_content__ZN6qm" role="complementary"><div class="aside_text__LFH_Q">
<h4 class="typography_heading__D82WZ typography_h4__CDRaM"><span class="heading-text">Example<!-- --> </span></h4>
<pre class="code_pre__kzg60"><code class="code_code__CILJL language-python language-python"></code></pre>
</div></div></aside><table class="table_root__ZlA_w"><thead><tr class="table_tr__K_tkF"><th class="table_th__QJ9F8">Name</th><th class="table_th__QJ9F8">Description</th></tr></thead><tbody><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">docs</code></td><td class="table_td__rmpJx">The documents to predict. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation">Iterable<span class="code_cli-arg-subtle__IgB5m">[</span><a class="link_root__1Me7D" href="/api/doc">Doc</a><span class="code_cli-arg-subtle__IgB5m">]</span></span></td></tr><tr class="table_tr__K_tkF table_footer__gJRIy table-footer"><td class="table_td__rmpJx"><strong>RETURNS</strong></td><td class="table_td__rmpJx">The model’s prediction for each document.</td></tr></tbody></table></section>
<section id="section-set_annotations" class="section_root__k1hUl"><h2 id="set_annotations" class="typography_heading__D82WZ typography_h2__hzV3h"><a href="#set_annotations" class="heading-text typography_permalink__UiIRy">Transformer.set_annotations <!-- --> </a><span class="tag_root__NTSnK tag_spaced__Q9amH">method</span></h2><p>Assign the extracted features to the <code class="code_inline-code__Bq7ot">Doc</code> objects. By default, the
<a class="link_root__1Me7D link_nowrap__H7Oxl link_with-icon__NAVDA" href="/api/transformer#transformerdata"><code class="code_inline-code__Bq7ot">TransformerData</code></a> object is written to the
<a class="link_root__1Me7D" href="/api/transformer#assigned-attributes"><code class="code_inline-code__Bq7ot">Doc._.trf_data</code></a> attribute. Your <code class="code_inline-code__Bq7ot">set_extra_annotations</code>
callback is then called, if provided.</p><aside class="aside_root__667WA"><div class="aside_content__ZN6qm" role="complementary"><div class="aside_text__LFH_Q">
<h4 class="typography_heading__D82WZ typography_h4__CDRaM"><span class="heading-text">Example<!-- --> </span></h4>
<pre class="code_pre__kzg60"><code class="code_code__CILJL language-python language-python"></code></pre>
</div></div></aside><table class="table_root__ZlA_w"><thead><tr class="table_tr__K_tkF"><th class="table_th__QJ9F8">Name</th><th class="table_th__QJ9F8">Description</th></tr></thead><tbody><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">docs</code></td><td class="table_td__rmpJx">The documents to modify. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation">Iterable<span class="code_cli-arg-subtle__IgB5m">[</span><a class="link_root__1Me7D" href="/api/doc">Doc</a><span class="code_cli-arg-subtle__IgB5m">]</span></span></td></tr><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">scores</code></td><td class="table_td__rmpJx">The scores to set, produced by <code class="code_inline-code__Bq7ot">Transformer.predict</code>.</td></tr></tbody></table></section>
<section id="section-update" class="section_root__k1hUl"><h2 id="update" class="typography_heading__D82WZ typography_h2__hzV3h"><a href="#update" class="heading-text typography_permalink__UiIRy">Transformer.update <!-- --> </a><span class="tag_root__NTSnK tag_spaced__Q9amH">method</span></h2><p>Prepare for an update to the transformer. Like the <a class="link_root__1Me7D link_nowrap__H7Oxl link_with-icon__NAVDA" href="/api/tok2vec"><code class="code_inline-code__Bq7ot">Tok2Vec</code></a>
component, the <code class="code_inline-code__Bq7ot">Transformer</code> component is unusual in that it does not receive
“gold standard” annotations to calculate a weight update. The optimal output of
the transformer data is unknown – it’s a hidden layer inside the network that is
updated by backpropagating from output layers.</p><p>The <code class="code_inline-code__Bq7ot">Transformer</code> component therefore does <strong>not</strong> perform a weight update
during its own <code class="code_inline-code__Bq7ot">update</code> method. Instead, it runs its transformer model and
communicates the output and the backpropagation callback to any <strong>downstream
components</strong> that have been connected to it via the
<a class="link_root__1Me7D link_nowrap__H7Oxl link_with-icon__NAVDA" href="/api/architectures#TransformerListener"><span class="link_source-text__VDP74">TransformerListener</span></a> sublayer. If there
are multiple listeners, the last layer will actually backprop to the transformer
and call the optimizer, while the others simply increment the gradients.</p><aside class="aside_root__667WA"><div class="aside_content__ZN6qm" role="complementary"><div class="aside_text__LFH_Q">
<h4 class="typography_heading__D82WZ typography_h4__CDRaM"><span class="heading-text">Example<!-- --> </span></h4>
<pre class="code_pre__kzg60"><code class="code_code__CILJL language-python language-python"></code></pre>
</div></div></aside><table class="table_root__ZlA_w"><thead><tr class="table_tr__K_tkF"><th class="table_th__QJ9F8">Name</th><th class="table_th__QJ9F8">Description</th></tr></thead><tbody><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">examples</code></td><td class="table_td__rmpJx">A batch of <a class="link_root__1Me7D link_nowrap__H7Oxl link_with-icon__NAVDA" href="/api/example"><code class="code_inline-code__Bq7ot">Example</code></a> objects. Only the <a class="link_root__1Me7D link_nowrap__H7Oxl link_with-icon__NAVDA" href="/api/example#predicted"><code class="code_inline-code__Bq7ot">Example.predicted</code></a> <code class="code_inline-code__Bq7ot">Doc</code> object is used, the reference <code class="code_inline-code__Bq7ot">Doc</code> is ignored. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation">Iterable<span class="code_cli-arg-subtle__IgB5m">[</span><a class="link_root__1Me7D" href="/api/example">Example</a><span class="code_cli-arg-subtle__IgB5m">]</span></span></td></tr><tr class="table_tr__K_tkF table_divider__DRQHe"><td class="table_td__rmpJx"><em>keyword-only</em></td><td class="table_td__rmpJx"></td></tr><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">drop</code></td><td class="table_td__rmpJx">The dropout rate. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation">float</span></td></tr><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">sgd</code></td><td class="table_td__rmpJx">An optimizer. Will be created via <a class="link_root__1Me7D" href="/api/transformer#create_optimizer"><code class="code_inline-code__Bq7ot">create_optimizer</code></a> if not set. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation">Optional<span class="code_cli-arg-subtle__IgB5m">[</span><a class="link_root__1Me7D" rel="noopener nofollow noreferrer" target="_blank" href="https://thinc.ai/docs/api-optimizers">Optimizer</a><span class="code_cli-arg-subtle__IgB5m">]</span></span></td></tr><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">losses</code></td><td class="table_td__rmpJx">Optional record of the loss during training. Updated using the component name as the key. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation">Optional<span class="code_cli-arg-subtle__IgB5m">[</span>Dict<span class="code_cli-arg-subtle__IgB5m">[</span>str<span class="code_cli-arg-subtle__IgB5m">,</span> float<span class="code_cli-arg-subtle__IgB5m">]</span><span class="code_cli-arg-subtle__IgB5m">]</span></span></td></tr><tr class="table_tr__K_tkF table_footer__gJRIy table-footer"><td class="table_td__rmpJx"><strong>RETURNS</strong></td><td class="table_td__rmpJx">The updated <code class="code_inline-code__Bq7ot">losses</code> dictionary. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation">Dict<span class="code_cli-arg-subtle__IgB5m">[</span>str<span class="code_cli-arg-subtle__IgB5m">,</span> float<span class="code_cli-arg-subtle__IgB5m">]</span></span></td></tr></tbody></table></section>
<section id="section-create_optimizer" class="section_root__k1hUl"><h2 id="create_optimizer" class="typography_heading__D82WZ typography_h2__hzV3h"><a href="#create_optimizer" class="heading-text typography_permalink__UiIRy">Transformer.create_optimizer <!-- --> </a><span class="tag_root__NTSnK tag_spaced__Q9amH">method</span></h2><p>Create an optimizer for the pipeline component.</p><aside class="aside_root__667WA"><div class="aside_content__ZN6qm" role="complementary"><div class="aside_text__LFH_Q">
<h4 class="typography_heading__D82WZ typography_h4__CDRaM"><span class="heading-text">Example<!-- --> </span></h4>
<pre class="code_pre__kzg60"><code class="code_code__CILJL language-python language-python"></code></pre>
</div></div></aside><table class="table_root__ZlA_w"><thead><tr class="table_tr__K_tkF"><th class="table_th__QJ9F8">Name</th><th class="table_th__QJ9F8">Description</th></tr></thead><tbody><tr class="table_tr__K_tkF table_footer__gJRIy table-footer"><td class="table_td__rmpJx"><strong>RETURNS</strong></td><td class="table_td__rmpJx">The optimizer. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation"><a class="link_root__1Me7D" rel="noopener nofollow noreferrer" target="_blank" href="https://thinc.ai/docs/api-optimizers">Optimizer</a></span></td></tr></tbody></table></section>
<section id="section-use_params" class="section_root__k1hUl"><h2 id="use_params" class="typography_heading__D82WZ typography_h2__hzV3h"><a href="#use_params" class="heading-text typography_permalink__UiIRy">Transformer.use_params <!-- --> </a><span class="tag_root__NTSnK tag_spaced__Q9amH">method</span><span class="tag_root__NTSnK tag_spaced__Q9amH">contextmanager</span></h2><p>Modify the pipe’s model to use the given parameter values. At the end of the
context, the original parameters are restored.</p><aside class="aside_root__667WA"><div class="aside_content__ZN6qm" role="complementary"><div class="aside_text__LFH_Q">
<h4 class="typography_heading__D82WZ typography_h4__CDRaM"><span class="heading-text">Example<!-- --> </span></h4>
<pre class="code_pre__kzg60"><code class="code_code__CILJL language-python language-python"></code></pre>
</div></div></aside><table class="table_root__ZlA_w"><thead><tr class="table_tr__K_tkF"><th class="table_th__QJ9F8">Name</th><th class="table_th__QJ9F8">Description</th></tr></thead><tbody><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">params</code></td><td class="table_td__rmpJx">The parameter values to use in the model. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation">dict</span></td></tr></tbody></table></section>
<section id="section-to_disk" class="section_root__k1hUl"><h2 id="to_disk" class="typography_heading__D82WZ typography_h2__hzV3h"><a href="#to_disk" class="heading-text typography_permalink__UiIRy">Transformer.to_disk <!-- --> </a><span class="tag_root__NTSnK tag_spaced__Q9amH">method</span></h2><p>Serialize the pipe to disk.</p><aside class="aside_root__667WA"><div class="aside_content__ZN6qm" role="complementary"><div class="aside_text__LFH_Q">
<h4 class="typography_heading__D82WZ typography_h4__CDRaM"><span class="heading-text">Example<!-- --> </span></h4>
<pre class="code_pre__kzg60"><code class="code_code__CILJL language-python language-python"></code></pre>
</div></div></aside><table class="table_root__ZlA_w"><thead><tr class="table_tr__K_tkF"><th class="table_th__QJ9F8">Name</th><th class="table_th__QJ9F8">Description</th></tr></thead><tbody><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">path</code></td><td class="table_td__rmpJx">A path to a directory, which will be created if it doesn’t exist. Paths may be either strings or <code class="code_inline-code__Bq7ot">Path</code>-like objects. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation">Union<span class="code_cli-arg-subtle__IgB5m">[</span>str<span class="code_cli-arg-subtle__IgB5m">,</span><a class="link_root__1Me7D" rel="noopener nofollow noreferrer" target="_blank" href="https://docs.python.org/3/library/pathlib.html">Path</a><span class="code_cli-arg-subtle__IgB5m">]</span></span></td></tr><tr class="table_tr__K_tkF table_divider__DRQHe"><td class="table_td__rmpJx"><em>keyword-only</em></td><td class="table_td__rmpJx"></td></tr><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">exclude</code></td><td class="table_td__rmpJx">String names of <a class="link_root__1Me7D" href="/api/transformer#serialization-fields">serialization fields</a> to exclude. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation">Iterable<span class="code_cli-arg-subtle__IgB5m">[</span>str<span class="code_cli-arg-subtle__IgB5m">]</span></span></td></tr></tbody></table></section>
<section id="section-from_disk" class="section_root__k1hUl"><h2 id="from_disk" class="typography_heading__D82WZ typography_h2__hzV3h"><a href="#from_disk" class="heading-text typography_permalink__UiIRy">Transformer.from_disk <!-- --> </a><span class="tag_root__NTSnK tag_spaced__Q9amH">method</span></h2><p>Load the pipe from disk. Modifies the object in place and returns it.</p><aside class="aside_root__667WA"><div class="aside_content__ZN6qm" role="complementary"><div class="aside_text__LFH_Q">
<h4 class="typography_heading__D82WZ typography_h4__CDRaM"><span class="heading-text">Example<!-- --> </span></h4>
<pre class="code_pre__kzg60"><code class="code_code__CILJL language-python language-python"></code></pre>
</div></div></aside><table class="table_root__ZlA_w"><thead><tr class="table_tr__K_tkF"><th class="table_th__QJ9F8">Name</th><th class="table_th__QJ9F8">Description</th></tr></thead><tbody><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">path</code></td><td class="table_td__rmpJx">A path to a directory. Paths may be either strings or <code class="code_inline-code__Bq7ot">Path</code>-like objects. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation">Union<span class="code_cli-arg-subtle__IgB5m">[</span>str<span class="code_cli-arg-subtle__IgB5m">,</span><a class="link_root__1Me7D" rel="noopener nofollow noreferrer" target="_blank" href="https://docs.python.org/3/library/pathlib.html">Path</a><span class="code_cli-arg-subtle__IgB5m">]</span></span></td></tr><tr class="table_tr__K_tkF table_divider__DRQHe"><td class="table_td__rmpJx"><em>keyword-only</em></td><td class="table_td__rmpJx"></td></tr><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">exclude</code></td><td class="table_td__rmpJx">String names of <a class="link_root__1Me7D" href="/api/transformer#serialization-fields">serialization fields</a> to exclude. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation">Iterable<span class="code_cli-arg-subtle__IgB5m">[</span>str<span class="code_cli-arg-subtle__IgB5m">]</span></span></td></tr><tr class="table_tr__K_tkF table_footer__gJRIy table-footer"><td class="table_td__rmpJx"><strong>RETURNS</strong></td><td class="table_td__rmpJx">The modified <code class="code_inline-code__Bq7ot">Transformer</code> object. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation">Transformer</span></td></tr></tbody></table></section>
<section id="section-to_bytes" class="section_root__k1hUl"><h2 id="to_bytes" class="typography_heading__D82WZ typography_h2__hzV3h"><a href="#to_bytes" class="heading-text typography_permalink__UiIRy">Transformer.to_bytes <!-- --> </a><span class="tag_root__NTSnK tag_spaced__Q9amH">method</span></h2><aside class="aside_root__667WA"><div class="aside_content__ZN6qm" role="complementary"><div class="aside_text__LFH_Q">
<h4 class="typography_heading__D82WZ typography_h4__CDRaM"><span class="heading-text">Example<!-- --> </span></h4>
<pre class="code_pre__kzg60"><code class="code_code__CILJL language-python language-python"></code></pre>
</div></div></aside><p>Serialize the pipe to a bytestring.</p><table class="table_root__ZlA_w"><thead><tr class="table_tr__K_tkF"><th class="table_th__QJ9F8">Name</th><th class="table_th__QJ9F8">Description</th></tr></thead><tbody><tr class="table_tr__K_tkF table_divider__DRQHe"><td class="table_td__rmpJx"><em>keyword-only</em></td><td class="table_td__rmpJx"></td></tr><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">exclude</code></td><td class="table_td__rmpJx">String names of <a class="link_root__1Me7D" href="/api/transformer#serialization-fields">serialization fields</a> to exclude. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation">Iterable<span class="code_cli-arg-subtle__IgB5m">[</span>str<span class="code_cli-arg-subtle__IgB5m">]</span></span></td></tr><tr class="table_tr__K_tkF table_footer__gJRIy table-footer"><td class="table_td__rmpJx"><strong>RETURNS</strong></td><td class="table_td__rmpJx">The serialized form of the <code class="code_inline-code__Bq7ot">Transformer</code> object. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation">bytes</span></td></tr></tbody></table></section>
<section id="section-from_bytes" class="section_root__k1hUl"><h2 id="from_bytes" class="typography_heading__D82WZ typography_h2__hzV3h"><a href="#from_bytes" class="heading-text typography_permalink__UiIRy">Transformer.from_bytes <!-- --> </a><span class="tag_root__NTSnK tag_spaced__Q9amH">method</span></h2><p>Load the pipe from a bytestring. Modifies the object in place and returns it.</p><aside class="aside_root__667WA"><div class="aside_content__ZN6qm" role="complementary"><div class="aside_text__LFH_Q">
<h4 class="typography_heading__D82WZ typography_h4__CDRaM"><span class="heading-text">Example<!-- --> </span></h4>
<pre class="code_pre__kzg60"><code class="code_code__CILJL language-python language-python"></code></pre>
</div></div></aside><table class="table_root__ZlA_w"><thead><tr class="table_tr__K_tkF"><th class="table_th__QJ9F8">Name</th><th class="table_th__QJ9F8">Description</th></tr></thead><tbody><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">bytes_data</code></td><td class="table_td__rmpJx">The data to load from. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation">bytes</span></td></tr><tr class="table_tr__K_tkF table_divider__DRQHe"><td class="table_td__rmpJx"><em>keyword-only</em></td><td class="table_td__rmpJx"></td></tr><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">exclude</code></td><td class="table_td__rmpJx">String names of <a class="link_root__1Me7D" href="/api/transformer#serialization-fields">serialization fields</a> to exclude. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation">Iterable<span class="code_cli-arg-subtle__IgB5m">[</span>str<span class="code_cli-arg-subtle__IgB5m">]</span></span></td></tr><tr class="table_tr__K_tkF table_footer__gJRIy table-footer"><td class="table_td__rmpJx"><strong>RETURNS</strong></td><td class="table_td__rmpJx">The <code class="code_inline-code__Bq7ot">Transformer</code> object. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation">Transformer</span></td></tr></tbody></table></section>
<section id="section-serialization-fields" class="section_root__k1hUl"><h2 id="serialization-fields" class="typography_heading__D82WZ typography_h2__hzV3h"><a href="#serialization-fields" class="heading-text typography_permalink__UiIRy">Serialization fields <!-- --> </a></h2><p>During serialization, spaCy will export several data fields used to restore
different aspects of the object. If needed, you can exclude them from
serialization by passing in the string names via the <code class="code_inline-code__Bq7ot">exclude</code> argument.</p><aside class="aside_root__667WA"><div class="aside_content__ZN6qm" role="complementary"><div class="aside_text__LFH_Q">
<h4 class="typography_heading__D82WZ typography_h4__CDRaM"><span class="heading-text">Example<!-- --> </span></h4>
<pre class="code_pre__kzg60"><code class="code_code__CILJL language-python language-python"></code></pre>
</div></div></aside><table class="table_root__ZlA_w"><thead><tr class="table_tr__K_tkF"><th class="table_th__QJ9F8">Name</th><th class="table_th__QJ9F8">Description</th></tr></thead><tbody><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">vocab</code></td><td class="table_td__rmpJx">The shared <a class="link_root__1Me7D link_nowrap__H7Oxl link_with-icon__NAVDA" href="/api/vocab"><code class="code_inline-code__Bq7ot">Vocab</code></a>.</td></tr><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">cfg</code></td><td class="table_td__rmpJx">The config file. You usually don’t want to exclude this.</td></tr><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">model</code></td><td class="table_td__rmpJx">The binary model data. You usually don’t want to exclude this.</td></tr></tbody></table></section>
<section id="section-transformerdata" class="section_root__k1hUl"><h2 id="transformerdata" class="typography_heading__D82WZ typography_h2__hzV3h"><a href="#transformerdata" class="heading-text typography_permalink__UiIRy">TransformerData <!-- --> </a><span class="tag_root__NTSnK tag_spaced__Q9amH">dataclass</span></h2><p>Transformer tokens and outputs for one <code class="code_inline-code__Bq7ot">Doc</code> object. The transformer models
return tensors that refer to a whole padded batch of documents. These tensors
are wrapped into the
<a class="link_root__1Me7D link_with-icon__NAVDA" href="/api/transformer#fulltransformerbatch"><span class="link_source-text__VDP74">FullTransformerBatch</span></a> object. The
<code class="code_inline-code__Bq7ot">FullTransformerBatch</code> then splits out the per-document data, which is handled
by this class. Instances of this class are typically assigned to the
<a class="link_root__1Me7D link_nowrap__H7Oxl link_with-icon__NAVDA" href="/api/transformer#assigned-attributes"><code class="code_inline-code__Bq7ot">Doc._.trf_data</code></a> extension attribute.</p><table class="table_root__ZlA_w"><thead><tr class="table_tr__K_tkF"><th class="table_th__QJ9F8">Name</th><th class="table_th__QJ9F8">Description</th></tr></thead><tbody><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">tokens</code></td><td class="table_td__rmpJx">A slice of the tokens data produced by the tokenizer. This may have several fields, including the token IDs, the texts and the attention mask. See the <a class="link_root__1Me7D" rel="noopener nofollow noreferrer" target="_blank" href="https://huggingface.co/transformers/main_classes/tokenizer.html#transformers.BatchEncoding"><code class="code_inline-code__Bq7ot">transformers.BatchEncoding</code></a> object for details. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation">dict</span></td></tr><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">model_output</code></td><td class="table_td__rmpJx">The model output from the transformer model, determined by the model and transformer config. New in <code class="code_inline-code__Bq7ot">spacy-transformers</code> v1.1.0. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM code_wrap__b41os" role="code" aria-label="Type annotation"><a class="link_root__1Me7D" rel="noopener nofollow noreferrer" target="_blank" href="https://huggingface.co/transformers/main_classes/output.html#modeloutput">transformers.file_utils.ModelOutput</a></span></td></tr><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">tensors</code></td><td class="table_td__rmpJx">The <code class="code_inline-code__Bq7ot">model_output</code> in the earlier <code class="code_inline-code__Bq7ot">transformers</code> tuple format converted using <a class="link_root__1Me7D" rel="noopener nofollow noreferrer" target="_blank" href="https://huggingface.co/transformers/main_classes/output.html#transformers.file_utils.ModelOutput.to_tuple"><code class="code_inline-code__Bq7ot">ModelOutput.to_tuple()</code></a>. Returns <code class="code_inline-code__Bq7ot">Tuple</code> instead of <code class="code_inline-code__Bq7ot">List</code> as of <code class="code_inline-code__Bq7ot">spacy-transformers</code> v1.1.0. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM code_wrap__b41os" role="code" aria-label="Type annotation">Tuple<span class="code_cli-arg-subtle__IgB5m">[</span>Union<span class="code_cli-arg-subtle__IgB5m">[</span><a class="link_root__1Me7D" rel="noopener nofollow noreferrer" target="_blank" href="https://thinc.ai/docs/api-types#types">FloatsXd</a><span class="code_cli-arg-subtle__IgB5m">,</span> List<span class="code_cli-arg-subtle__IgB5m">[</span><a class="link_root__1Me7D" rel="noopener nofollow noreferrer" target="_blank" href="https://thinc.ai/docs/api-types#types">FloatsXd</a><span class="code_cli-arg-subtle__IgB5m">]</span><span class="code_cli-arg-subtle__IgB5m">]</span><span class="code_cli-arg-subtle__IgB5m">]</span></span></td></tr><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">align</code></td><td class="table_td__rmpJx">Alignment from the <code class="code_inline-code__Bq7ot">Doc</code>’s tokenization to the wordpieces. This is a ragged array, where <code class="code_inline-code__Bq7ot">align.lengths[i]</code> indicates the number of wordpiece tokens that token <code class="code_inline-code__Bq7ot">i</code> aligns against. The actual indices are provided at <code class="code_inline-code__Bq7ot">align[i].dataXd</code>. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation"><a class="link_root__1Me7D" rel="noopener nofollow noreferrer" target="_blank" href="https://thinc.ai/docs/api-types#ragged">Ragged</a></span></td></tr><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">width</code></td><td class="table_td__rmpJx">The width of the last hidden layer. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation">int</span></td></tr></tbody></table><h3 id="transformerdata-emoty" class="typography_heading__D82WZ typography_h3__mPKmB"><a href="#transformerdata-emoty" class="heading-text typography_permalink__UiIRy">TransformerData.empty <!-- --> </a><span class="tag_root__NTSnK tag_spaced__Q9amH">classmethod</span></h3><p>Create an empty <code class="code_inline-code__Bq7ot">TransformerData</code> container.</p><table class="table_root__ZlA_w"><thead><tr class="table_tr__K_tkF"><th class="table_th__QJ9F8">Name</th><th class="table_th__QJ9F8">Description</th></tr></thead><tbody><tr class="table_tr__K_tkF table_footer__gJRIy table-footer"><td class="table_td__rmpJx"><strong>RETURNS</strong></td><td class="table_td__rmpJx">The container. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation"><a class="link_root__1Me7D" href="/api/transformer#transformerdata">TransformerData</a></span></td></tr></tbody></table><section class="accordion"><div class="accordion_root__pPltq accordion_spaced__Ebyjn"><h4><button class="accordion_button__IPO0E" aria-expanded="true"><span><span class="heading-text">Previous versions of TransformerData</span></span><svg class="accordion_icon__fpBl7" width="20" height="20" viewBox="0 0 10 10" aria-hidden="true" focusable="false"><rect class="accordion_hidden__tgILw" height="8" width="2" x="4" y="1"></rect><rect height="2" width="8" x="1" y="4"></rect></svg></button></h4><div class="accordion_content__divKS"><p>In <code class="code_inline-code__Bq7ot">spacy-transformers</code> v1.0, the model output is stored in
<code class="code_inline-code__Bq7ot">TransformerData.tensors</code> as <code class="code_inline-code__Bq7ot">List[Union[FloatsXd]]</code> and only includes the
activations for the <code class="code_inline-code__Bq7ot">Doc</code> from the transformer. Usually the last tensor that is
3-dimensional will be the most important, as that will provide the final hidden
state. Generally activations that are 2-dimensional will be attention weights.
Details of this variable will differ depending on the underlying transformer
model.</p></div></div></section></section>
<section id="section-fulltransformerbatch" class="section_root__k1hUl"><h2 id="fulltransformerbatch" class="typography_heading__D82WZ typography_h2__hzV3h"><a href="#fulltransformerbatch" class="heading-text typography_permalink__UiIRy">FullTransformerBatch <!-- --> </a><span class="tag_root__NTSnK tag_spaced__Q9amH">dataclass</span></h2><p>Holds a batch of input and output objects for a transformer model. The data can
then be split to a list of <a class="link_root__1Me7D link_nowrap__H7Oxl link_with-icon__NAVDA" href="/api/transformer#transformerdata"><code class="code_inline-code__Bq7ot">TransformerData</code></a>
objects to associate the outputs to each <a class="link_root__1Me7D link_nowrap__H7Oxl link_with-icon__NAVDA" href="/api/doc"><code class="code_inline-code__Bq7ot">Doc</code></a> in the batch.</p><table class="table_root__ZlA_w"><thead><tr class="table_tr__K_tkF"><th class="table_th__QJ9F8">Name</th><th class="table_th__QJ9F8">Description</th></tr></thead><tbody><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">spans</code></td><td class="table_td__rmpJx">The batch of input spans. The outer list refers to the Doc objects in the batch, and the inner list are the spans for that <code class="code_inline-code__Bq7ot">Doc</code>. Note that spans are allowed to overlap or exclude tokens, but each <code class="code_inline-code__Bq7ot">Span</code> can only refer to one <code class="code_inline-code__Bq7ot">Doc</code> (by definition). This means that within a <code class="code_inline-code__Bq7ot">Doc</code>, the regions of the output tensors that correspond to each <code class="code_inline-code__Bq7ot">Span</code> may overlap or have gaps, but for each <code class="code_inline-code__Bq7ot">Doc</code>, there is a non-overlapping contiguous slice of the outputs. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation">List<span class="code_cli-arg-subtle__IgB5m">[</span>List<span class="code_cli-arg-subtle__IgB5m">[</span><a class="link_root__1Me7D" href="/api/span">Span</a><span class="code_cli-arg-subtle__IgB5m">]</span><span class="code_cli-arg-subtle__IgB5m">]</span></span></td></tr><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">tokens</code></td><td class="table_td__rmpJx">The output of the tokenizer. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation"><a class="link_root__1Me7D" rel="noopener nofollow noreferrer" target="_blank" href="https://huggingface.co/transformers/main_classes/tokenizer.html#transformers.BatchEncoding">transformers.BatchEncoding</a></span></td></tr><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">model_output</code></td><td class="table_td__rmpJx">The model output from the transformer model, determined by the model and transformer config. New in <code class="code_inline-code__Bq7ot">spacy-transformers</code> v1.1.0. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM code_wrap__b41os" role="code" aria-label="Type annotation"><a class="link_root__1Me7D" rel="noopener nofollow noreferrer" target="_blank" href="https://huggingface.co/transformers/main_classes/output.html#modeloutput">transformers.file_utils.ModelOutput</a></span></td></tr><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">tensors</code></td><td class="table_td__rmpJx">The <code class="code_inline-code__Bq7ot">model_output</code> in the earlier <code class="code_inline-code__Bq7ot">transformers</code> tuple format converted using <a class="link_root__1Me7D" rel="noopener nofollow noreferrer" target="_blank" href="https://huggingface.co/transformers/main_classes/output.html#transformers.file_utils.ModelOutput.to_tuple"><code class="code_inline-code__Bq7ot">ModelOutput.to_tuple()</code></a>. Returns <code class="code_inline-code__Bq7ot">Tuple</code> instead of <code class="code_inline-code__Bq7ot">List</code> as of <code class="code_inline-code__Bq7ot">spacy-transformers</code> v1.1.0. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM code_wrap__b41os" role="code" aria-label="Type annotation">Tuple<span class="code_cli-arg-subtle__IgB5m">[</span>Union<span class="code_cli-arg-subtle__IgB5m">[</span><a class="link_root__1Me7D" rel="noopener nofollow noreferrer" target="_blank" href="https://pytorch.org/docs/stable/tensors.html">torch.Tensor</a><span class="code_cli-arg-subtle__IgB5m">,</span> Tuple<span class="code_cli-arg-subtle__IgB5m">[</span><a class="link_root__1Me7D" rel="noopener nofollow noreferrer" target="_blank" href="https://pytorch.org/docs/stable/tensors.html">torch.Tensor</a><span class="code_cli-arg-subtle__IgB5m">]</span><span class="code_cli-arg-subtle__IgB5m">]</span><span class="code_cli-arg-subtle__IgB5m">]</span></span></td></tr><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">align</code></td><td class="table_td__rmpJx">Alignment from the spaCy tokenization to the wordpieces. This is a ragged array, where <code class="code_inline-code__Bq7ot">align.lengths[i]</code> indicates the number of wordpiece tokens that token <code class="code_inline-code__Bq7ot">i</code> aligns against. The actual indices are provided at <code class="code_inline-code__Bq7ot">align[i].dataXd</code>. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation"><a class="link_root__1Me7D" rel="noopener nofollow noreferrer" target="_blank" href="https://thinc.ai/docs/api-types#ragged">Ragged</a></span></td></tr><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">doc_data</code></td><td class="table_td__rmpJx">The outputs, split per <code class="code_inline-code__Bq7ot">Doc</code> object. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation">List<span class="code_cli-arg-subtle__IgB5m">[</span><a class="link_root__1Me7D" href="/api/transformer#transformerdata">TransformerData</a><span class="code_cli-arg-subtle__IgB5m">]</span></span></td></tr></tbody></table><h3 id="fulltransformerbatch-unsplit_by_doc" class="typography_heading__D82WZ typography_h3__mPKmB"><a href="#fulltransformerbatch-unsplit_by_doc" class="heading-text typography_permalink__UiIRy">FullTransformerBatch.unsplit_by_doc <!-- --> </a><span class="tag_root__NTSnK tag_spaced__Q9amH">method</span></h3><p>Return a new <code class="code_inline-code__Bq7ot">FullTransformerBatch</code> from a split batch of activations, using the
current object’s spans, tokens and alignment. This is used during the backward
pass, in order to construct the gradients to pass back into the transformer
model.</p><table class="table_root__ZlA_w"><thead><tr class="table_tr__K_tkF"><th class="table_th__QJ9F8">Name</th><th class="table_th__QJ9F8">Description</th></tr></thead><tbody><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">arrays</code></td><td class="table_td__rmpJx">The split batch of activations. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation">List<span class="code_cli-arg-subtle__IgB5m">[</span>List<span class="code_cli-arg-subtle__IgB5m">[</span><a class="link_root__1Me7D" rel="noopener nofollow noreferrer" target="_blank" href="https://thinc.ai/docs/api-types#types">Floats3d</a><span class="code_cli-arg-subtle__IgB5m">]</span><span class="code_cli-arg-subtle__IgB5m">]</span></span></td></tr><tr class="table_tr__K_tkF table_footer__gJRIy table-footer"><td class="table_td__rmpJx"><strong>RETURNS</strong></td><td class="table_td__rmpJx">The transformer batch. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation"><a class="link_root__1Me7D" href="/api/transformer#fulltransformerbatch">FullTransformerBatch</a></span></td></tr></tbody></table><h3 id="fulltransformerbatch-split_by_doc" class="typography_heading__D82WZ typography_h3__mPKmB"><a href="#fulltransformerbatch-split_by_doc" class="heading-text typography_permalink__UiIRy">FullTransformerBatch.split_by_doc <!-- --> </a><span class="tag_root__NTSnK tag_spaced__Q9amH">method</span></h3><p>Split a <code class="code_inline-code__Bq7ot">TransformerData</code> object that represents a batch into a list with one
<code class="code_inline-code__Bq7ot">TransformerData</code> per <code class="code_inline-code__Bq7ot">Doc</code>.</p><table class="table_root__ZlA_w"><thead><tr class="table_tr__K_tkF"><th class="table_th__QJ9F8">Name</th><th class="table_th__QJ9F8">Description</th></tr></thead><tbody><tr class="table_tr__K_tkF table_footer__gJRIy table-footer"><td class="table_td__rmpJx"><strong>RETURNS</strong></td><td class="table_td__rmpJx">The split batch. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation">List<span class="code_cli-arg-subtle__IgB5m">[</span><a class="link_root__1Me7D" href="/api/transformer#transformerdata">TransformerData</a><span class="code_cli-arg-subtle__IgB5m">]</span></span></td></tr></tbody></table><section class="accordion"><div class="accordion_root__pPltq accordion_spaced__Ebyjn"><h4><button class="accordion_button__IPO0E" aria-expanded="true"><span><span class="heading-text">Previous versions of FullTransformerBatch</span></span><svg class="accordion_icon__fpBl7" width="20" height="20" viewBox="0 0 10 10" aria-hidden="true" focusable="false"><rect class="accordion_hidden__tgILw" height="8" width="2" x="4" y="1"></rect><rect height="2" width="8" x="1" y="4"></rect></svg></button></h4><div class="accordion_content__divKS"><p>In <code class="code_inline-code__Bq7ot">spacy-transformers</code> v1.0, the model output is stored in
<code class="code_inline-code__Bq7ot">FullTransformerBatch.tensors</code> as <code class="code_inline-code__Bq7ot">List[torch.Tensor]</code>.</p></div></div></section></section>
<section id="section-span_getters" class="section_root__k1hUl"><h2 id="span_getters" class="typography_heading__D82WZ typography_h2__hzV3h typography_clear__LuXx9"><a href="#span_getters" class="heading-text typography_permalink__UiIRy">Span getters <!-- --> </a><div class="typography_action__rv_MQ"><a class="link_root__1Me7D button_root__jwipc button_secondary__ukZAk" rel="noopener nofollow noreferrer" target="_blank" href="https://github.com/explosion/spacy-transformers/blob/master/spacy_transformers/span_getters.py">Source</a></div></h2><p>Span getters are functions that take a batch of <a class="link_root__1Me7D link_nowrap__H7Oxl link_with-icon__NAVDA" href="/api/doc"><code class="code_inline-code__Bq7ot">Doc</code></a> objects and
return a lists of <a class="link_root__1Me7D link_nowrap__H7Oxl link_with-icon__NAVDA" href="/api/span"><code class="code_inline-code__Bq7ot">Span</code></a> objects for each doc to be processed by
the transformer. This is used to manage long documents by cutting them into
smaller sequences before running the transformer. The spans are allowed to
overlap, and you can also omit sections of the <code class="code_inline-code__Bq7ot">Doc</code> if they are not relevant.</p><p>Span getters can be referenced in the <code class="code_inline-code__Bq7ot code_wrap__b41os">[components.transformer.model.get_spans]</code>
block of the config to customize the sequences processed by the transformer. You
can also register
<a class="link_root__1Me7D" href="/usage/embeddings-transformers#transformers-training-custom-settings">custom span getters</a>
using the <code class="code_inline-code__Bq7ot">@spacy.registry.span_getters</code> decorator.</p><aside class="aside_root__667WA"><div class="aside_content__ZN6qm" role="complementary"><div class="aside_text__LFH_Q">
<h4 class="typography_heading__D82WZ typography_h4__CDRaM"><span class="heading-text">Example<!-- --> </span></h4>
<pre class="code_pre__kzg60"><code class="code_code__CILJL language-python language-python"></code></pre>
</div></div></aside><table class="table_root__ZlA_w"><thead><tr class="table_tr__K_tkF"><th class="table_th__QJ9F8">Name</th><th class="table_th__QJ9F8">Description</th></tr></thead><tbody><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">docs</code></td><td class="table_td__rmpJx">A batch of <code class="code_inline-code__Bq7ot">Doc</code> objects. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation">Iterable<span class="code_cli-arg-subtle__IgB5m">[</span><a class="link_root__1Me7D" href="/api/doc">Doc</a><span class="code_cli-arg-subtle__IgB5m">]</span></span></td></tr><tr class="table_tr__K_tkF table_footer__gJRIy table-footer"><td class="table_td__rmpJx"><strong>RETURNS</strong></td><td class="table_td__rmpJx">The spans to process by the transformer. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation">List<span class="code_cli-arg-subtle__IgB5m">[</span>List<span class="code_cli-arg-subtle__IgB5m">[</span><a class="link_root__1Me7D" href="/api/span">Span</a><span class="code_cli-arg-subtle__IgB5m">]</span><span class="code_cli-arg-subtle__IgB5m">]</span></span></td></tr></tbody></table><h3 id="doc_spans" class="typography_heading__D82WZ typography_h3__mPKmB"><a href="#doc_spans" class="heading-text typography_permalink__UiIRy">doc_spans.v1 <!-- --> </a><span class="tag_root__NTSnK tag_spaced__Q9amH">registered function</span></h3><aside class="aside_root__667WA"><div class="aside_content__ZN6qm" role="complementary"><div class="aside_text__LFH_Q">
<h4 class="typography_heading__D82WZ typography_h4__CDRaM"><span class="heading-text">Example config<!-- --> </span></h4>
<pre class="code_pre__kzg60"><code class="code_code__CILJL language-ini language-ini"></code></pre>
</div></div></aside><p>Create a span getter that uses the whole document as its spans. This is the best
approach if your <a class="link_root__1Me7D link_nowrap__H7Oxl link_with-icon__NAVDA" href="/api/doc"><code class="code_inline-code__Bq7ot">Doc</code></a> objects already refer to relatively short
texts.</p><h3 id="sent_spans" class="typography_heading__D82WZ typography_h3__mPKmB"><a href="#sent_spans" class="heading-text typography_permalink__UiIRy">sent_spans.v1 <!-- --> </a><span class="tag_root__NTSnK tag_spaced__Q9amH">registered function</span></h3><aside class="aside_root__667WA"><div class="aside_content__ZN6qm" role="complementary"><div class="aside_text__LFH_Q">
<h4 class="typography_heading__D82WZ typography_h4__CDRaM"><span class="heading-text">Example config<!-- --> </span></h4>
<pre class="code_pre__kzg60"><code class="code_code__CILJL language-ini language-ini"></code></pre>
</div></div></aside><p>Create a span getter that uses sentence boundary markers to extract the spans.
This requires sentence boundaries to be set (e.g. by the
<a class="link_root__1Me7D link_nowrap__H7Oxl link_with-icon__NAVDA" href="/api/sentencizer"><code class="code_inline-code__Bq7ot">Sentencizer</code></a>), and may result in somewhat uneven batches,
depending on the sentence lengths. However, it does provide the transformer with
more meaningful windows to attend over.</p><p>To set sentence boundaries with the <code class="code_inline-code__Bq7ot">sentencizer</code> during training, add a
<code class="code_inline-code__Bq7ot">sentencizer</code> to the beginning of the pipeline and include it in
<a class="link_root__1Me7D" href="/usage/training#annotating-components"><code class="code_inline-code__Bq7ot code_wrap__b41os">[training.annotating_components]</code></a> to
have it set the sentence boundaries before the <code class="code_inline-code__Bq7ot">transformer</code> component runs.</p><h3 id="strided_spans" class="typography_heading__D82WZ typography_h3__mPKmB"><a href="#strided_spans" class="heading-text typography_permalink__UiIRy">strided_spans.v1 <!-- --> </a><span class="tag_root__NTSnK tag_spaced__Q9amH">registered function</span></h3><aside class="aside_root__667WA"><div class="aside_content__ZN6qm" role="complementary"><div class="aside_text__LFH_Q">
<h4 class="typography_heading__D82WZ typography_h4__CDRaM"><span class="heading-text">Example config<!-- --> </span></h4>
<pre class="code_pre__kzg60"><code class="code_code__CILJL language-ini language-ini"></code></pre>
</div></div></aside><p>Create a span getter for strided spans. If you set the <code class="code_inline-code__Bq7ot">window</code> and <code class="code_inline-code__Bq7ot">stride</code> to
the same value, the spans will cover each token once. Setting <code class="code_inline-code__Bq7ot">stride</code> lower
than <code class="code_inline-code__Bq7ot">window</code> will allow for an overlap, so that some tokens are counted twice.
This can be desirable, because it allows all tokens to have both a left and
right context.</p><table class="table_root__ZlA_w"><thead><tr class="table_tr__K_tkF"><th class="table_th__QJ9F8">Name</th><th class="table_th__QJ9F8">Description</th></tr></thead><tbody><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">window</code></td><td class="table_td__rmpJx">The window size. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation">int</span></td></tr><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">stride</code></td><td class="table_td__rmpJx">The stride size. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation">int</span></td></tr></tbody></table></section>
<section id="section-annotation_setters" class="section_root__k1hUl"><h2 id="annotation_setters" class="typography_heading__D82WZ typography_h2__hzV3h typography_clear__LuXx9"><a href="#annotation_setters" class="heading-text typography_permalink__UiIRy">Annotation setters <!-- --> </a><span class="tag_root__NTSnK tag_spaced__Q9amH">registered functions</span><div class="typography_action__rv_MQ"><a class="link_root__1Me7D button_root__jwipc button_secondary__ukZAk" rel="noopener nofollow noreferrer" target="_blank" href="https://github.com/explosion/spacy-transformers/blob/master/spacy_transformers/annotation_setters.py">Source</a></div></h2><p>Annotation setters are functions that take a batch of <code class="code_inline-code__Bq7ot">Doc</code> objects and a
<a class="link_root__1Me7D link_nowrap__H7Oxl link_with-icon__NAVDA" href="/api/transformer#fulltransformerbatch"><code class="code_inline-code__Bq7ot">FullTransformerBatch</code></a> and can set
additional annotations on the <code class="code_inline-code__Bq7ot">Doc</code>, e.g. to set custom or built-in attributes.
You can register custom annotation setters using the
<code class="code_inline-code__Bq7ot">@registry.annotation_setters</code> decorator.</p><aside class="aside_root__667WA"><div class="aside_content__ZN6qm" role="complementary"><div class="aside_text__LFH_Q">
<h4 class="typography_heading__D82WZ typography_h4__CDRaM"><span class="heading-text">Example<!-- --> </span></h4>
<pre class="code_pre__kzg60"><code class="code_code__CILJL language-python language-python"></code></pre>
</div></div></aside><table class="table_root__ZlA_w"><thead><tr class="table_tr__K_tkF"><th class="table_th__QJ9F8">Name</th><th class="table_th__QJ9F8">Description</th></tr></thead><tbody><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">docs</code></td><td class="table_td__rmpJx">A batch of <code class="code_inline-code__Bq7ot">Doc</code> objects. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation">List<span class="code_cli-arg-subtle__IgB5m">[</span><a class="link_root__1Me7D" href="/api/doc">Doc</a><span class="code_cli-arg-subtle__IgB5m">]</span></span></td></tr><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot">trf_data</code></td><td class="table_td__rmpJx">The transformers data for the batch. <span class="type-annotation language-python code_inline-code__Bq7ot code_type-annotation__6N9RM" role="code" aria-label="Type annotation"><a class="link_root__1Me7D" href="/api/transformer#fulltransformerbatch">FullTransformerBatch</a></span></td></tr></tbody></table><p>The following built-in functions are available:</p><table class="table_root__ZlA_w"><thead><tr class="table_tr__K_tkF"><th class="table_th__QJ9F8">Name</th><th class="table_th__QJ9F8">Description</th></tr></thead><tbody><tr class="table_tr__K_tkF"><td class="table_td__rmpJx"><code class="code_inline-code__Bq7ot code_wrap__b41os">spacy-transformers.null_annotation_setter.v1</code></td><td class="table_td__rmpJx">Don’t set any additional annotations.</td></tr></tbody></table></section><div class="grid_root__EfDZl grid_spacing__fhBCv grid_half__xoJZs"><div style="margin-top:var(--spacing-lg)"><a class="link_root__1Me7D button_root__jwipc button_secondary__ukZAk" rel="noopener nofollow noreferrer" target="_blank" href="https://github.com/explosion/spaCy/tree/master/website/docs/api/transformer.mdx">Suggest edits</a></div></div></article><div class="main_asides__RITE5" style="background-image:url(/_next/static/media/pattern_green.92f07e1d.png"></div><footer class="footer_root__zlkjP"><div class="grid_root__EfDZl footer_content__LaE1F grid_narrow__x_6xS grid_spacing__fhBCv grid_third__edHuB"><section><ul class="footer_column__DPe22"><li class="footer_label__xK7_s">spaCy</li><li><a class="link_root__1Me7D link_no-link-layout__RPvod" href="/usage">Usage</a></li><li><a class="link_root__1Me7D link_no-link-layout__RPvod" href="/models">Models</a></li><li><a class="link_root__1Me7D link_no-link-layout__RPvod" href="/api">API Reference</a></li><li><a class="link_root__1Me7D link_no-link-layout__RPvod" href="https://course.spacy.io">Online Course</a></li><li><a class="link_root__1Me7D link_no-link-layout__RPvod" href="https://explosion.ai/custom-solutions">Custom Solutions</a></li></ul></section><section><ul class="footer_column__DPe22"><li class="footer_label__xK7_s">Community</li><li><a class="link_root__1Me7D link_no-link-layout__RPvod" href="/universe">Universe</a></li><li><a class="link_root__1Me7D link_no-link-layout__RPvod" rel="noopener nofollow noreferrer" target="_blank" href="https://github.com/explosion/spaCy/discussions">GitHub Discussions</a></li><li><a class="link_root__1Me7D link_no-link-layout__RPvod" rel="noopener nofollow noreferrer" target="_blank" href="https://github.com/explosion/spaCy/issues">Issue Tracker</a></li><li><a class="link_root__1Me7D link_no-link-layout__RPvod" rel="noopener nofollow noreferrer" target="_blank" href="http://stackoverflow.com/questions/tagged/spacy">Stack Overflow</a></li></ul></section><section><ul class="footer_column__DPe22"><li class="footer_label__xK7_s">Connect</li><li><a class="link_root__1Me7D link_no-link-layout__RPvod" rel="noopener nofollow noreferrer" target="_blank" href="https://twitter.com/spacy_io">Twitter</a></li><li><a class="link_root__1Me7D link_no-link-layout__RPvod" rel="noopener nofollow noreferrer" target="_blank" href="https://github.com/explosion/spaCy">GitHub</a></li><li><a class="link_root__1Me7D link_no-link-layout__RPvod" rel="noopener nofollow noreferrer" target="_blank" href="https://youtube.com/c/ExplosionAI">YouTube</a></li><li><a class="link_root__1Me7D link_no-link-layout__RPvod" href="https://explosion.ai/blog">Blog</a></li></ul></section><section class="footer_full___icln"><ul class="footer_column__DPe22"><li class="footer_label__xK7_s">Stay in the loop!</li><li>Receive updates about new releases, tutorials and more.</li><li><form id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" action="//spacy.us12.list-manage.com/subscribe/post?u=83b0498b1e7fa3c91ce68c3f1&amp;amp;id=ecc82e0493" method="post" target="_blank" novalidate=""><div style="position:absolute;left:-5000px" aria-hidden="true"><input type="text" name="b_83b0498b1e7fa3c91ce68c3f1_ecc82e0493" tabindex="-1" value=""/></div><div class="newsletter_root__uh6MU"><input class="newsletter_input___SMSB" id="mce-EMAIL" type="email" name="EMAIL" placeholder="Your email" aria-label="Your email"/><button class="newsletter_button__gKW8E" id="mc-embedded-subscribe" type="submit" name="subscribe">Sign up</button></div></form></li></ul></section></div><div class="footer_content__LaE1F footer_copy__rbjvc"><span>© 2016-<!-- -->2023<!-- --> <a class="link_root__1Me7D link_no-link-layout__RPvod" href="https://explosion.ai">Explosion</a></span><a class="link_root__1Me7D footer_logo__BthsJ link_no-link-layout__RPvod" aria-label="Explosion" href="https://explosion.ai"></a><a class="link_root__1Me7D link_no-link-layout__RPvod" href="https://explosion.ai/legal">Legal / Imprint</a></div></footer></main></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"title":"Transformer","teaser":"Pipeline component for multi-task learning with transformer models","tag":"class","source":"github.com/explosion/spacy-transformers/blob/master/spacy_transformers/pipeline_component.py","version":3,"api_base_class":"/api/pipe","api_string_name":"transformer","slug":"/api/transformer","mdx":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    section: \"section\",\n    blockquote: \"blockquote\",\n    h4: \"h4\",\n    pre: \"pre\",\n    code: \"code\",\n    p: \"p\",\n    a: \"a\",\n    h2: \"h2\",\n    table: \"table\",\n    thead: \"thead\",\n    tr: \"tr\",\n    th: \"th\",\n    tbody: \"tbody\",\n    td: \"td\",\n    del: \"del\",\n    em: \"em\",\n    strong: \"strong\",\n    h3: \"h3\"\n  }, _provideComponents(), props.components), {Infobox, InlineCode, Accordion} = _components;\n  if (!Accordion) _missingMdxReference(\"Accordion\", true);\n  if (!Infobox) _missingMdxReference(\"Infobox\", true);\n  if (!InlineCode) _missingMdxReference(\"InlineCode\", true);\n  return _jsxs(_Fragment, {\n    children: [_jsxs(_components.section, {\n      children: [_jsxs(_components.blockquote, {\n        children: [\"\\n\", _jsx(_components.h4, {\n          children: \"Installation\"\n        }), \"\\n\", _jsx(_components.pre, {\n          children: _jsx(_components.code, {\n            className: \"language-bash\",\n            lang: \"bash\",\n            children: \"$ pip install -U spacy[transformers] \\n\"\n          })\n        }), \"\\n\"]\n      }), _jsx(Infobox, {\n        title: \"Important note\",\n        variant: \"warning\",\n        children: _jsxs(_components.p, {\n          children: [\"This component is available via the extension package\\n\", _jsx(_components.a, {\n            href: \"https://github.com/explosion/spacy-transformers\",\n            children: _jsx(InlineCode, {\n              children: \"spacy-transformers\"\n            })\n          }), \". It\\nexposes the component via entry points, so if you have the package installed,\\nusing \", _jsx(InlineCode, {\n            children: \"factory = \\\"transformer\\\"\"\n          }), \" in your\\n\", _jsx(_components.a, {\n            href: \"/usage/training#config\",\n            children: \"training config\"\n          }), \" or \", _jsx(InlineCode, {\n            children: \"nlp.add_pipe(\\\"transformer\\\")\"\n          }), \" will\\nwork out-of-the-box.\"]\n        })\n      }), _jsxs(_components.p, {\n        children: [\"This pipeline component lets you use transformer models in your pipeline. It\\nsupports all models that are available via the\\n\", _jsxs(_components.a, {\n          href: \"https://huggingface.co/transformers\",\n          children: [\"HuggingFace \", _jsx(InlineCode, {\n            children: \"transformers\"\n          })]\n        }), \" library.\\nUsually you will connect subsequent components to the shared transformer using\\nthe \", _jsx(_components.a, {\n          href: \"/api/architectures#TransformerListener\",\n          children: \"TransformerListener\"\n        }), \" layer. This\\nworks similarly to spaCy’s \", _jsx(_components.a, {\n          href: \"/api/tok2vec\",\n          children: \"Tok2Vec\"\n        }), \" component and\\n\", _jsx(_components.a, {\n          href: \"/api/architectures/#Tok2VecListener\",\n          children: \"Tok2VecListener\"\n        }), \" sublayer.\"]\n      }), _jsxs(_components.p, {\n        children: [\"The component assigns the output of the transformer to the \", _jsx(InlineCode, {\n          children: \"Doc\"\n        }), \"’s extension\\nattributes. We also calculate an alignment between the word-piece tokens and the\\nspaCy tokenization, so that we can use the last hidden states to set the\\n\", _jsx(InlineCode, {\n          children: \"Doc.tensor\"\n        }), \" attribute. When multiple word-piece tokens align to the same spaCy\\ntoken, the spaCy token receives the sum of their values. To access the values,\\nyou can use the custom \", _jsx(_components.a, {\n          href: \"#assigned-attributes\",\n          children: _jsx(InlineCode, {\n            children: \"Doc._.trf_data\"\n          })\n        }), \" attribute. The\\npackage also adds the function registries \", _jsx(_components.a, {\n          href: \"#span_getters\",\n          children: _jsx(InlineCode, {\n            children: \"@span_getters\"\n          })\n        }), \" and\\n\", _jsx(_components.a, {\n          href: \"#annotation_setters\",\n          children: _jsx(InlineCode, {\n            children: \"@annotation_setters\"\n          })\n        }), \" with several built-in registered\\nfunctions. For more details, see the\\n\", _jsx(_components.a, {\n          href: \"/usage/embeddings-transformers\",\n          children: \"usage documentation\"\n        }), \".\"]\n      })]\n    }), \"\\n\", _jsxs(_components.section, {\n      id: \"section-assigned-attributes\",\n      children: [_jsx(_components.h2, {\n        id: \"assigned-attributes\",\n        children: \"Assigned Attributes \"\n      }), _jsxs(_components.p, {\n        children: [\"The component sets the following\\n\", _jsx(_components.a, {\n          href: \"/usage/processing-pipeline#custom-components-attributes\",\n          children: \"custom extension attribute\"\n        }), \":\"]\n      }), _jsxs(_components.table, {\n        children: [_jsx(_components.thead, {\n          children: _jsxs(_components.tr, {\n            children: [_jsx(_components.th, {\n              children: \"Location\"\n            }), _jsx(_components.th, {\n              children: \"Value\"\n            })]\n          })\n        }), _jsx(_components.tbody, {\n          children: _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"Doc._.trf_data\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"Transformer tokens and outputs for the \", _jsx(InlineCode, {\n                children: \"Doc\"\n              }), \" object. \", _jsx(_components.del, {\n                children: \"TransformerData\"\n              })]\n            })]\n          })\n        })]\n      })]\n    }), \"\\n\", _jsxs(_components.section, {\n      id: \"section-config\",\n      children: [_jsx(_components.h2, {\n        id: \"config\",\n        children: \"Config and implementation \"\n      }), _jsxs(_components.p, {\n        children: [\"The default config is defined by the pipeline component factory and describes\\nhow the component should be configured. You can override its settings via the\\n\", _jsx(InlineCode, {\n          children: \"config\"\n        }), \" argument on \", _jsx(_components.a, {\n          href: \"/api/language#add_pipe\",\n          children: _jsx(InlineCode, {\n            children: \"nlp.add_pipe\"\n          })\n        }), \" or in your\\n\", _jsxs(_components.a, {\n          href: \"/usage/training#config\",\n          children: [_jsx(InlineCode, {\n            children: \"config.cfg\"\n          }), \" for training\"]\n        }), \". See the\\n\", _jsx(_components.a, {\n          href: \"/api/architectures#transformers\",\n          children: \"model architectures\"\n        }), \" documentation for details\\non the transformer architectures and their arguments and hyperparameters.\"]\n      }), _jsxs(_components.blockquote, {\n        children: [\"\\n\", _jsx(_components.h4, {\n          children: \"Example\"\n        }), \"\\n\", _jsx(_components.pre, {\n          children: _jsx(_components.code, {\n            className: \"language-python\",\n            lang: \"python\",\n            children: \"from spacy_transformers import Transformer\\nfrom spacy_transformers.pipeline_component import DEFAULT_CONFIG\\n\\nnlp.add_pipe(\\\"transformer\\\", config=DEFAULT_CONFIG[\\\"transformer\\\"])\\n\"\n          })\n        }), \"\\n\"]\n      }), _jsxs(_components.table, {\n        children: [_jsx(_components.thead, {\n          children: _jsxs(_components.tr, {\n            children: [_jsx(_components.th, {\n              children: \"Setting\"\n            }), _jsx(_components.th, {\n              children: \"Description\"\n            })]\n          })\n        }), _jsxs(_components.tbody, {\n          children: [_jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"max_batch_items\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"Maximum size of a padded batch. Defaults to \", _jsx(InlineCode, {\n                children: \"4096\"\n              }), \". \", _jsx(_components.del, {\n                children: \"int\"\n              })]\n            })]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"set_extra_annotations\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"Function that takes a batch of \", _jsx(InlineCode, {\n                children: \"Doc\"\n              }), \" objects and transformer outputs to set additional annotations on the \", _jsx(InlineCode, {\n                children: \"Doc\"\n              }), \". The \", _jsx(InlineCode, {\n                children: \"Doc._.trf_data\"\n              }), \" attribute is set prior to calling the callback. Defaults to \", _jsx(InlineCode, {\n                children: \"null_annotation_setter\"\n              }), \" (no additional annotations). \", _jsx(_components.del, {\n                children: \"Callable[[List[Doc], FullTransformerBatch], None]\"\n              })]\n            })]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"model\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"The Thinc \", _jsx(_components.a, {\n                href: \"https://thinc.ai/docs/api-model\",\n                children: _jsx(InlineCode, {\n                  children: \"Model\"\n                })\n              }), \" wrapping the transformer. Defaults to \", _jsx(_components.a, {\n                href: \"/api/architectures#TransformerModel\",\n                children: \"TransformerModel\"\n              }), \". \", _jsx(_components.del, {\n                children: \"Model[List[Doc], FullTransformerBatch]\"\n              })]\n            })]\n          })]\n        })]\n      }), _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          className: \"language-python\",\n          lang: \"python\",\n          github: \"https://github.com/explosion/spacy-transformers/blob/master/spacy_transformers/pipeline_component.py\",\n          children: \"https://github.com/explosion/spacy-transformers/blob/master/spacy_transformers/pipeline_component.py\\n\"\n        })\n      })]\n    }), \"\\n\", _jsxs(_components.section, {\n      id: \"section-init\",\n      children: [_jsx(_components.h2, {\n        id: \"init\",\n        tag: \"method\",\n        children: \"Transformer.__init__ \"\n      }), _jsxs(_components.blockquote, {\n        children: [\"\\n\", _jsx(_components.h4, {\n          children: \"Example\"\n        }), \"\\n\", _jsx(_components.pre, {\n          children: _jsx(_components.code, {\n            className: \"language-python\",\n            lang: \"python\",\n            children: \"# Construction via add_pipe with default model\\ntrf = nlp.add_pipe(\\\"transformer\\\")\\n\\n# Construction via add_pipe with custom config\\nconfig = {\\n    \\\"model\\\": {\\n        \\\"@architectures\\\": \\\"spacy-transformers.TransformerModel.v3\\\",\\n        \\\"name\\\": \\\"bert-base-uncased\\\",\\n        \\\"tokenizer_config\\\": {\\\"use_fast\\\": True},\\n        \\\"transformer_config\\\": {\\\"output_attentions\\\": True},\\n        \\\"mixed_precision\\\": True,\\n        \\\"grad_scaler_config\\\": {\\\"init_scale\\\": 32768}\\n    }\\n}\\ntrf = nlp.add_pipe(\\\"transformer\\\", config=config)\\n\\n# Construction from class\\nfrom spacy_transformers import Transformer\\ntrf = Transformer(nlp.vocab, model)\\n\"\n          })\n        }), \"\\n\"]\n      }), _jsxs(_components.p, {\n        children: [\"Construct a \", _jsx(InlineCode, {\n          children: \"Transformer\"\n        }), \" component. One or more subsequent spaCy components can\\nuse the transformer outputs as features in its model, with gradients\\nbackpropagated to the single shared weights. The activations from the\\ntransformer are saved in the \", _jsx(_components.a, {\n          href: \"#assigned-attributes\",\n          children: _jsx(InlineCode, {\n            children: \"Doc._.trf_data\"\n          })\n        }), \" extension\\nattribute. You can also provide a callback to set additional annotations. In\\nyour application, you would normally use a shortcut for this and instantiate the\\ncomponent using its string name and \", _jsx(_components.a, {\n          href: \"/api/language#create_pipe\",\n          children: _jsx(InlineCode, {\n            children: \"nlp.add_pipe\"\n          })\n        }), \".\"]\n      }), _jsxs(_components.table, {\n        children: [_jsx(_components.thead, {\n          children: _jsxs(_components.tr, {\n            children: [_jsx(_components.th, {\n              children: \"Name\"\n            }), _jsx(_components.th, {\n              children: \"Description\"\n            })]\n          })\n        }), _jsxs(_components.tbody, {\n          children: [_jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"vocab\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"The shared vocabulary. \", _jsx(_components.del, {\n                children: \"Vocab\"\n              })]\n            })]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"model\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"The Thinc \", _jsx(_components.a, {\n                href: \"https://thinc.ai/docs/api-model\",\n                children: _jsx(InlineCode, {\n                  children: \"Model\"\n                })\n              }), \" wrapping the transformer. Usually you will want to use the \", _jsx(_components.a, {\n                href: \"/api/architectures#TransformerModel\",\n                children: \"TransformerModel\"\n              }), \" layer for this. \", _jsx(_components.del, {\n                children: \"Model[List[Doc], FullTransformerBatch]\"\n              })]\n            })]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"set_extra_annotations\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"Function that takes a batch of \", _jsx(InlineCode, {\n                children: \"Doc\"\n              }), \" objects and transformer outputs and stores the annotations on the \", _jsx(InlineCode, {\n                children: \"Doc\"\n              }), \". The \", _jsx(InlineCode, {\n                children: \"Doc._.trf_data\"\n              }), \" attribute is set prior to calling the callback. By default, no additional annotations are set. \", _jsx(_components.del, {\n                children: \"Callable[[List[Doc], FullTransformerBatch], None]\"\n              })]\n            })]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(_components.em, {\n                children: \"keyword-only\"\n              })\n            }), _jsx(_components.td, {})]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"name\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"String name of the component instance. Used to add entries to the \", _jsx(InlineCode, {\n                children: \"losses\"\n              }), \" during training. \", _jsx(_components.del, {\n                children: \"str\"\n              })]\n            })]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"max_batch_items\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"Maximum size of a padded batch. Defaults to \", _jsx(InlineCode, {\n                children: \"128*32\"\n              }), \". \", _jsx(_components.del, {\n                children: \"int\"\n              })]\n            })]\n          })]\n        })]\n      })]\n    }), \"\\n\", _jsxs(_components.section, {\n      id: \"section-call\",\n      children: [_jsx(_components.h2, {\n        id: \"call\",\n        tag: \"method\",\n        children: \"Transformer.__call__ \"\n      }), _jsxs(_components.p, {\n        children: [\"Apply the pipe to one document. The document is modified in place, and returned.\\nThis usually happens under the hood when the \", _jsx(InlineCode, {\n          children: \"nlp\"\n        }), \" object is called on a text\\nand all pipeline components are applied to the \", _jsx(InlineCode, {\n          children: \"Doc\"\n        }), \" in order. Both\\n\", _jsx(_components.a, {\n          href: \"/api/transformer#call\",\n          children: _jsx(InlineCode, {\n            children: \"__call__\"\n          })\n        }), \" and \", _jsx(_components.a, {\n          href: \"/api/transformer#pipe\",\n          children: _jsx(InlineCode, {\n            children: \"pipe\"\n          })\n        }), \" delegate\\nto the \", _jsx(_components.a, {\n          href: \"/api/transformer#predict\",\n          children: _jsx(InlineCode, {\n            children: \"predict\"\n          })\n        }), \" and\\n\", _jsx(_components.a, {\n          href: \"/api/transformer#set_annotations\",\n          children: _jsx(InlineCode, {\n            children: \"set_annotations\"\n          })\n        }), \" methods.\"]\n      }), _jsxs(_components.blockquote, {\n        children: [\"\\n\", _jsx(_components.h4, {\n          children: \"Example\"\n        }), \"\\n\", _jsx(_components.pre, {\n          children: _jsx(_components.code, {\n            className: \"language-python\",\n            lang: \"python\",\n            children: \"doc = nlp(\\\"This is a sentence.\\\")\\ntrf = nlp.add_pipe(\\\"transformer\\\")\\n# This usually happens under the hood\\nprocessed = transformer(doc)\\n\"\n          })\n        }), \"\\n\"]\n      }), _jsxs(_components.table, {\n        children: [_jsx(_components.thead, {\n          children: _jsxs(_components.tr, {\n            children: [_jsx(_components.th, {\n              children: \"Name\"\n            }), _jsx(_components.th, {\n              children: \"Description\"\n            })]\n          })\n        }), _jsxs(_components.tbody, {\n          children: [_jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"doc\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"The document to process. \", _jsx(_components.del, {\n                children: \"Doc\"\n              })]\n            })]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(_components.strong, {\n                children: \"RETURNS\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"The processed document. \", _jsx(_components.del, {\n                children: \"Doc\"\n              })]\n            })]\n          })]\n        })]\n      })]\n    }), \"\\n\", _jsxs(_components.section, {\n      id: \"section-pipe\",\n      children: [_jsx(_components.h2, {\n        id: \"pipe\",\n        tag: \"method\",\n        children: \"Transformer.pipe \"\n      }), _jsxs(_components.p, {\n        children: [\"Apply the pipe to a stream of documents. This usually happens under the hood\\nwhen the \", _jsx(InlineCode, {\n          children: \"nlp\"\n        }), \" object is called on a text and all pipeline components are\\napplied to the \", _jsx(InlineCode, {\n          children: \"Doc\"\n        }), \" in order. Both \", _jsx(_components.a, {\n          href: \"/api/transformer#call\",\n          children: _jsx(InlineCode, {\n            children: \"__call__\"\n          })\n        }), \" and\\n\", _jsx(_components.a, {\n          href: \"/api/transformer#pipe\",\n          children: _jsx(InlineCode, {\n            children: \"pipe\"\n          })\n        }), \" delegate to the\\n\", _jsx(_components.a, {\n          href: \"/api/transformer#predict\",\n          children: _jsx(InlineCode, {\n            children: \"predict\"\n          })\n        }), \" and\\n\", _jsx(_components.a, {\n          href: \"/api/transformer#set_annotations\",\n          children: _jsx(InlineCode, {\n            children: \"set_annotations\"\n          })\n        }), \" methods.\"]\n      }), _jsxs(_components.blockquote, {\n        children: [\"\\n\", _jsx(_components.h4, {\n          children: \"Example\"\n        }), \"\\n\", _jsx(_components.pre, {\n          children: _jsx(_components.code, {\n            className: \"language-python\",\n            lang: \"python\",\n            children: \"trf = nlp.add_pipe(\\\"transformer\\\")\\nfor doc in trf.pipe(docs, batch_size=50):\\n    pass\\n\"\n          })\n        }), \"\\n\"]\n      }), _jsxs(_components.table, {\n        children: [_jsx(_components.thead, {\n          children: _jsxs(_components.tr, {\n            children: [_jsx(_components.th, {\n              children: \"Name\"\n            }), _jsx(_components.th, {\n              children: \"Description\"\n            })]\n          })\n        }), _jsxs(_components.tbody, {\n          children: [_jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"stream\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"A stream of documents. \", _jsx(_components.del, {\n                children: \"Iterable[Doc]\"\n              })]\n            })]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(_components.em, {\n                children: \"keyword-only\"\n              })\n            }), _jsx(_components.td, {})]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"batch_size\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"The number of documents to buffer. Defaults to \", _jsx(InlineCode, {\n                children: \"128\"\n              }), \". \", _jsx(_components.del, {\n                children: \"int\"\n              })]\n            })]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(_components.strong, {\n                children: \"YIELDS\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"The processed documents in order. \", _jsx(_components.del, {\n                children: \"Doc\"\n              })]\n            })]\n          })]\n        })]\n      })]\n    }), \"\\n\", _jsxs(_components.section, {\n      id: \"section-initialize\",\n      children: [_jsx(_components.h2, {\n        id: \"initialize\",\n        tag: \"method\",\n        children: \"Transformer.initialize \"\n      }), _jsxs(_components.p, {\n        children: [\"Initialize the component for training and return an\\n\", _jsx(_components.a, {\n          href: \"https://thinc.ai/docs/api-optimizers\",\n          children: _jsx(InlineCode, {\n            children: \"Optimizer\"\n          })\n        }), \". \", _jsx(InlineCode, {\n          children: \"get_examples\"\n        }), \" should be a\\nfunction that returns an iterable of \", _jsx(_components.a, {\n          href: \"/api/example\",\n          children: _jsx(InlineCode, {\n            children: \"Example\"\n          })\n        }), \" objects. \", _jsx(_components.strong, {\n          children: \"At\\nleast one example should be supplied.\"\n        }), \" The data examples are used to\\n\", _jsx(_components.strong, {\n          children: \"initialize the model\"\n        }), \" of the component and can either be the full training\\ndata or a representative sample. Initialization includes validating the network,\\n\", _jsx(_components.a, {\n          href: \"https://thinc.ai/docs/usage-models#validation\",\n          children: \"inferring missing shapes\"\n        }), \" and\\nsetting up the label scheme based on the data. This method is typically called\\nby \", _jsx(_components.a, {\n          href: \"/api/language#initialize\",\n          children: _jsx(InlineCode, {\n            children: \"Language.initialize\"\n          })\n        }), \".\"]\n      }), _jsxs(_components.blockquote, {\n        children: [\"\\n\", _jsx(_components.h4, {\n          children: \"Example\"\n        }), \"\\n\", _jsx(_components.pre, {\n          children: _jsx(_components.code, {\n            className: \"language-python\",\n            lang: \"python\",\n            children: \"trf = nlp.add_pipe(\\\"transformer\\\")\\ntrf.initialize(lambda: examples, nlp=nlp)\\n\"\n          })\n        }), \"\\n\"]\n      }), _jsxs(_components.table, {\n        children: [_jsx(_components.thead, {\n          children: _jsxs(_components.tr, {\n            children: [_jsx(_components.th, {\n              children: \"Name\"\n            }), _jsx(_components.th, {\n              children: \"Description\"\n            })]\n          })\n        }), _jsxs(_components.tbody, {\n          children: [_jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"get_examples\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"Function that returns gold-standard annotations in the form of \", _jsx(_components.a, {\n                href: \"/api/example\",\n                children: _jsx(InlineCode, {\n                  children: \"Example\"\n                })\n              }), \" objects. Must contain at least one \", _jsx(InlineCode, {\n                children: \"Example\"\n              }), \". \", _jsx(_components.del, {\n                children: \"Callable[[], Iterable[Example]]\"\n              })]\n            })]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(_components.em, {\n                children: \"keyword-only\"\n              })\n            }), _jsx(_components.td, {})]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"nlp\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"The current \", _jsx(InlineCode, {\n                children: \"nlp\"\n              }), \" object. Defaults to \", _jsx(InlineCode, {\n                children: \"None\"\n              }), \". \", _jsx(_components.del, {\n                children: \"Optional[Language]\"\n              })]\n            })]\n          })]\n        })]\n      })]\n    }), \"\\n\", _jsxs(_components.section, {\n      id: \"section-predict\",\n      children: [_jsx(_components.h2, {\n        id: \"predict\",\n        tag: \"method\",\n        children: \"Transformer.predict \"\n      }), _jsxs(_components.p, {\n        children: [\"Apply the component’s model to a batch of \", _jsx(_components.a, {\n          href: \"/api/doc\",\n          children: _jsx(InlineCode, {\n            children: \"Doc\"\n          })\n        }), \" objects without\\nmodifying them.\"]\n      }), _jsxs(_components.blockquote, {\n        children: [\"\\n\", _jsx(_components.h4, {\n          children: \"Example\"\n        }), \"\\n\", _jsx(_components.pre, {\n          children: _jsx(_components.code, {\n            className: \"language-python\",\n            lang: \"python\",\n            children: \"trf = nlp.add_pipe(\\\"transformer\\\")\\nscores = trf.predict([doc1, doc2])\\n\"\n          })\n        }), \"\\n\"]\n      }), _jsxs(_components.table, {\n        children: [_jsx(_components.thead, {\n          children: _jsxs(_components.tr, {\n            children: [_jsx(_components.th, {\n              children: \"Name\"\n            }), _jsx(_components.th, {\n              children: \"Description\"\n            })]\n          })\n        }), _jsxs(_components.tbody, {\n          children: [_jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"docs\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"The documents to predict. \", _jsx(_components.del, {\n                children: \"Iterable[Doc]\"\n              })]\n            })]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(_components.strong, {\n                children: \"RETURNS\"\n              })\n            }), _jsx(_components.td, {\n              children: \"The model’s prediction for each document.\"\n            })]\n          })]\n        })]\n      })]\n    }), \"\\n\", _jsxs(_components.section, {\n      id: \"section-set_annotations\",\n      children: [_jsx(_components.h2, {\n        id: \"set_annotations\",\n        tag: \"method\",\n        children: \"Transformer.set_annotations \"\n      }), _jsxs(_components.p, {\n        children: [\"Assign the extracted features to the \", _jsx(InlineCode, {\n          children: \"Doc\"\n        }), \" objects. By default, the\\n\", _jsx(_components.a, {\n          href: \"/api/transformer#transformerdata\",\n          children: _jsx(InlineCode, {\n            children: \"TransformerData\"\n          })\n        }), \" object is written to the\\n\", _jsx(_components.a, {\n          href: \"#assigned-attributes\",\n          children: _jsx(InlineCode, {\n            children: \"Doc._.trf_data\"\n          })\n        }), \" attribute. Your \", _jsx(InlineCode, {\n          children: \"set_extra_annotations\"\n        }), \"\\ncallback is then called, if provided.\"]\n      }), _jsxs(_components.blockquote, {\n        children: [\"\\n\", _jsx(_components.h4, {\n          children: \"Example\"\n        }), \"\\n\", _jsx(_components.pre, {\n          children: _jsx(_components.code, {\n            className: \"language-python\",\n            lang: \"python\",\n            children: \"trf = nlp.add_pipe(\\\"transformer\\\")\\nscores = trf.predict(docs)\\ntrf.set_annotations(docs, scores)\\n\"\n          })\n        }), \"\\n\"]\n      }), _jsxs(_components.table, {\n        children: [_jsx(_components.thead, {\n          children: _jsxs(_components.tr, {\n            children: [_jsx(_components.th, {\n              children: \"Name\"\n            }), _jsx(_components.th, {\n              children: \"Description\"\n            })]\n          })\n        }), _jsxs(_components.tbody, {\n          children: [_jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"docs\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"The documents to modify. \", _jsx(_components.del, {\n                children: \"Iterable[Doc]\"\n              })]\n            })]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"scores\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"The scores to set, produced by \", _jsx(InlineCode, {\n                children: \"Transformer.predict\"\n              }), \".\"]\n            })]\n          })]\n        })]\n      })]\n    }), \"\\n\", _jsxs(_components.section, {\n      id: \"section-update\",\n      children: [_jsx(_components.h2, {\n        id: \"update\",\n        tag: \"method\",\n        children: \"Transformer.update \"\n      }), _jsxs(_components.p, {\n        children: [\"Prepare for an update to the transformer. Like the \", _jsx(_components.a, {\n          href: \"/api/tok2vec\",\n          children: _jsx(InlineCode, {\n            children: \"Tok2Vec\"\n          })\n        }), \"\\ncomponent, the \", _jsx(InlineCode, {\n          children: \"Transformer\"\n        }), \" component is unusual in that it does not receive\\n“gold standard” annotations to calculate a weight update. The optimal output of\\nthe transformer data is unknown – it’s a hidden layer inside the network that is\\nupdated by backpropagating from output layers.\"]\n      }), _jsxs(_components.p, {\n        children: [\"The \", _jsx(InlineCode, {\n          children: \"Transformer\"\n        }), \" component therefore does \", _jsx(_components.strong, {\n          children: \"not\"\n        }), \" perform a weight update\\nduring its own \", _jsx(InlineCode, {\n          children: \"update\"\n        }), \" method. Instead, it runs its transformer model and\\ncommunicates the output and the backpropagation callback to any \", _jsx(_components.strong, {\n          children: \"downstream\\ncomponents\"\n        }), \" that have been connected to it via the\\n\", _jsx(_components.a, {\n          href: \"/api/architectures#TransformerListener\",\n          children: \"TransformerListener\"\n        }), \" sublayer. If there\\nare multiple listeners, the last layer will actually backprop to the transformer\\nand call the optimizer, while the others simply increment the gradients.\"]\n      }), _jsxs(_components.blockquote, {\n        children: [\"\\n\", _jsx(_components.h4, {\n          children: \"Example\"\n        }), \"\\n\", _jsx(_components.pre, {\n          children: _jsx(_components.code, {\n            className: \"language-python\",\n            lang: \"python\",\n            children: \"trf = nlp.add_pipe(\\\"transformer\\\")\\noptimizer = nlp.initialize()\\nlosses = trf.update(examples, sgd=optimizer)\\n\"\n          })\n        }), \"\\n\"]\n      }), _jsxs(_components.table, {\n        children: [_jsx(_components.thead, {\n          children: _jsxs(_components.tr, {\n            children: [_jsx(_components.th, {\n              children: \"Name\"\n            }), _jsx(_components.th, {\n              children: \"Description\"\n            })]\n          })\n        }), _jsxs(_components.tbody, {\n          children: [_jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"examples\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"A batch of \", _jsx(_components.a, {\n                href: \"/api/example\",\n                children: _jsx(InlineCode, {\n                  children: \"Example\"\n                })\n              }), \" objects. Only the \", _jsx(_components.a, {\n                href: \"/api/example#predicted\",\n                children: _jsx(InlineCode, {\n                  children: \"Example.predicted\"\n                })\n              }), \" \", _jsx(InlineCode, {\n                children: \"Doc\"\n              }), \" object is used, the reference \", _jsx(InlineCode, {\n                children: \"Doc\"\n              }), \" is ignored. \", _jsx(_components.del, {\n                children: \"Iterable[Example]\"\n              })]\n            })]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(_components.em, {\n                children: \"keyword-only\"\n              })\n            }), _jsx(_components.td, {})]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"drop\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"The dropout rate. \", _jsx(_components.del, {\n                children: \"float\"\n              })]\n            })]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"sgd\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"An optimizer. Will be created via \", _jsx(_components.a, {\n                href: \"#create_optimizer\",\n                children: _jsx(InlineCode, {\n                  children: \"create_optimizer\"\n                })\n              }), \" if not set. \", _jsx(_components.del, {\n                children: \"Optional[Optimizer]\"\n              })]\n            })]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"losses\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"Optional record of the loss during training. Updated using the component name as the key. \", _jsx(_components.del, {\n                children: \"Optional[Dict[str, float]]\"\n              })]\n            })]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(_components.strong, {\n                children: \"RETURNS\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"The updated \", _jsx(InlineCode, {\n                children: \"losses\"\n              }), \" dictionary. \", _jsx(_components.del, {\n                children: \"Dict[str, float]\"\n              })]\n            })]\n          })]\n        })]\n      })]\n    }), \"\\n\", _jsxs(_components.section, {\n      id: \"section-create_optimizer\",\n      children: [_jsx(_components.h2, {\n        id: \"create_optimizer\",\n        tag: \"method\",\n        children: \"Transformer.create_optimizer \"\n      }), _jsx(_components.p, {\n        children: \"Create an optimizer for the pipeline component.\"\n      }), _jsxs(_components.blockquote, {\n        children: [\"\\n\", _jsx(_components.h4, {\n          children: \"Example\"\n        }), \"\\n\", _jsx(_components.pre, {\n          children: _jsx(_components.code, {\n            className: \"language-python\",\n            lang: \"python\",\n            children: \"trf = nlp.add_pipe(\\\"transformer\\\")\\noptimizer = trf.create_optimizer()\\n\"\n          })\n        }), \"\\n\"]\n      }), _jsxs(_components.table, {\n        children: [_jsx(_components.thead, {\n          children: _jsxs(_components.tr, {\n            children: [_jsx(_components.th, {\n              children: \"Name\"\n            }), _jsx(_components.th, {\n              children: \"Description\"\n            })]\n          })\n        }), _jsx(_components.tbody, {\n          children: _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(_components.strong, {\n                children: \"RETURNS\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"The optimizer. \", _jsx(_components.del, {\n                children: \"Optimizer\"\n              })]\n            })]\n          })\n        })]\n      })]\n    }), \"\\n\", _jsxs(_components.section, {\n      id: \"section-use_params\",\n      children: [_jsx(_components.h2, {\n        id: \"use_params\",\n        tag: \"method, contextmanager\",\n        children: \"Transformer.use_params \"\n      }), _jsx(_components.p, {\n        children: \"Modify the pipe’s model to use the given parameter values. At the end of the\\ncontext, the original parameters are restored.\"\n      }), _jsxs(_components.blockquote, {\n        children: [\"\\n\", _jsx(_components.h4, {\n          children: \"Example\"\n        }), \"\\n\", _jsx(_components.pre, {\n          children: _jsx(_components.code, {\n            className: \"language-python\",\n            lang: \"python\",\n            children: \"trf = nlp.add_pipe(\\\"transformer\\\")\\nwith trf.use_params(optimizer.averages):\\n    trf.to_disk(\\\"/best_model\\\")\\n\"\n          })\n        }), \"\\n\"]\n      }), _jsxs(_components.table, {\n        children: [_jsx(_components.thead, {\n          children: _jsxs(_components.tr, {\n            children: [_jsx(_components.th, {\n              children: \"Name\"\n            }), _jsx(_components.th, {\n              children: \"Description\"\n            })]\n          })\n        }), _jsx(_components.tbody, {\n          children: _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"params\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"The parameter values to use in the model. \", _jsx(_components.del, {\n                children: \"dict\"\n              })]\n            })]\n          })\n        })]\n      })]\n    }), \"\\n\", _jsxs(_components.section, {\n      id: \"section-to_disk\",\n      children: [_jsx(_components.h2, {\n        id: \"to_disk\",\n        tag: \"method\",\n        children: \"Transformer.to_disk \"\n      }), _jsx(_components.p, {\n        children: \"Serialize the pipe to disk.\"\n      }), _jsxs(_components.blockquote, {\n        children: [\"\\n\", _jsx(_components.h4, {\n          children: \"Example\"\n        }), \"\\n\", _jsx(_components.pre, {\n          children: _jsx(_components.code, {\n            className: \"language-python\",\n            lang: \"python\",\n            children: \"trf = nlp.add_pipe(\\\"transformer\\\")\\ntrf.to_disk(\\\"/path/to/transformer\\\")\\n\"\n          })\n        }), \"\\n\"]\n      }), _jsxs(_components.table, {\n        children: [_jsx(_components.thead, {\n          children: _jsxs(_components.tr, {\n            children: [_jsx(_components.th, {\n              children: \"Name\"\n            }), _jsx(_components.th, {\n              children: \"Description\"\n            })]\n          })\n        }), _jsxs(_components.tbody, {\n          children: [_jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"path\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"A path to a directory, which will be created if it doesn’t exist. Paths may be either strings or \", _jsx(InlineCode, {\n                children: \"Path\"\n              }), \"-like objects. \", _jsx(_components.del, {\n                children: \"Union[str, Path]\"\n              })]\n            })]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(_components.em, {\n                children: \"keyword-only\"\n              })\n            }), _jsx(_components.td, {})]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"exclude\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"String names of \", _jsx(_components.a, {\n                href: \"#serialization-fields\",\n                children: \"serialization fields\"\n              }), \" to exclude. \", _jsx(_components.del, {\n                children: \"Iterable[str]\"\n              })]\n            })]\n          })]\n        })]\n      })]\n    }), \"\\n\", _jsxs(_components.section, {\n      id: \"section-from_disk\",\n      children: [_jsx(_components.h2, {\n        id: \"from_disk\",\n        tag: \"method\",\n        children: \"Transformer.from_disk \"\n      }), _jsx(_components.p, {\n        children: \"Load the pipe from disk. Modifies the object in place and returns it.\"\n      }), _jsxs(_components.blockquote, {\n        children: [\"\\n\", _jsx(_components.h4, {\n          children: \"Example\"\n        }), \"\\n\", _jsx(_components.pre, {\n          children: _jsx(_components.code, {\n            className: \"language-python\",\n            lang: \"python\",\n            children: \"trf = nlp.add_pipe(\\\"transformer\\\")\\ntrf.from_disk(\\\"/path/to/transformer\\\")\\n\"\n          })\n        }), \"\\n\"]\n      }), _jsxs(_components.table, {\n        children: [_jsx(_components.thead, {\n          children: _jsxs(_components.tr, {\n            children: [_jsx(_components.th, {\n              children: \"Name\"\n            }), _jsx(_components.th, {\n              children: \"Description\"\n            })]\n          })\n        }), _jsxs(_components.tbody, {\n          children: [_jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"path\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"A path to a directory. Paths may be either strings or \", _jsx(InlineCode, {\n                children: \"Path\"\n              }), \"-like objects. \", _jsx(_components.del, {\n                children: \"Union[str, Path]\"\n              })]\n            })]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(_components.em, {\n                children: \"keyword-only\"\n              })\n            }), _jsx(_components.td, {})]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"exclude\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"String names of \", _jsx(_components.a, {\n                href: \"#serialization-fields\",\n                children: \"serialization fields\"\n              }), \" to exclude. \", _jsx(_components.del, {\n                children: \"Iterable[str]\"\n              })]\n            })]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(_components.strong, {\n                children: \"RETURNS\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"The modified \", _jsx(InlineCode, {\n                children: \"Transformer\"\n              }), \" object. \", _jsx(_components.del, {\n                children: \"Transformer\"\n              })]\n            })]\n          })]\n        })]\n      })]\n    }), \"\\n\", _jsxs(_components.section, {\n      id: \"section-to_bytes\",\n      children: [_jsx(_components.h2, {\n        id: \"to_bytes\",\n        tag: \"method\",\n        children: \"Transformer.to_bytes \"\n      }), _jsxs(_components.blockquote, {\n        children: [\"\\n\", _jsx(_components.h4, {\n          children: \"Example\"\n        }), \"\\n\", _jsx(_components.pre, {\n          children: _jsx(_components.code, {\n            className: \"language-python\",\n            lang: \"python\",\n            children: \"trf = nlp.add_pipe(\\\"transformer\\\")\\ntrf_bytes = trf.to_bytes()\\n\"\n          })\n        }), \"\\n\"]\n      }), _jsx(_components.p, {\n        children: \"Serialize the pipe to a bytestring.\"\n      }), _jsxs(_components.table, {\n        children: [_jsx(_components.thead, {\n          children: _jsxs(_components.tr, {\n            children: [_jsx(_components.th, {\n              children: \"Name\"\n            }), _jsx(_components.th, {\n              children: \"Description\"\n            })]\n          })\n        }), _jsxs(_components.tbody, {\n          children: [_jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(_components.em, {\n                children: \"keyword-only\"\n              })\n            }), _jsx(_components.td, {})]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"exclude\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"String names of \", _jsx(_components.a, {\n                href: \"#serialization-fields\",\n                children: \"serialization fields\"\n              }), \" to exclude. \", _jsx(_components.del, {\n                children: \"Iterable[str]\"\n              })]\n            })]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(_components.strong, {\n                children: \"RETURNS\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"The serialized form of the \", _jsx(InlineCode, {\n                children: \"Transformer\"\n              }), \" object. \", _jsx(_components.del, {\n                children: \"bytes\"\n              })]\n            })]\n          })]\n        })]\n      })]\n    }), \"\\n\", _jsxs(_components.section, {\n      id: \"section-from_bytes\",\n      children: [_jsx(_components.h2, {\n        id: \"from_bytes\",\n        tag: \"method\",\n        children: \"Transformer.from_bytes \"\n      }), _jsx(_components.p, {\n        children: \"Load the pipe from a bytestring. Modifies the object in place and returns it.\"\n      }), _jsxs(_components.blockquote, {\n        children: [\"\\n\", _jsx(_components.h4, {\n          children: \"Example\"\n        }), \"\\n\", _jsx(_components.pre, {\n          children: _jsx(_components.code, {\n            className: \"language-python\",\n            lang: \"python\",\n            children: \"trf_bytes = trf.to_bytes()\\ntrf = nlp.add_pipe(\\\"transformer\\\")\\ntrf.from_bytes(trf_bytes)\\n\"\n          })\n        }), \"\\n\"]\n      }), _jsxs(_components.table, {\n        children: [_jsx(_components.thead, {\n          children: _jsxs(_components.tr, {\n            children: [_jsx(_components.th, {\n              children: \"Name\"\n            }), _jsx(_components.th, {\n              children: \"Description\"\n            })]\n          })\n        }), _jsxs(_components.tbody, {\n          children: [_jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"bytes_data\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"The data to load from. \", _jsx(_components.del, {\n                children: \"bytes\"\n              })]\n            })]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(_components.em, {\n                children: \"keyword-only\"\n              })\n            }), _jsx(_components.td, {})]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"exclude\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"String names of \", _jsx(_components.a, {\n                href: \"#serialization-fields\",\n                children: \"serialization fields\"\n              }), \" to exclude. \", _jsx(_components.del, {\n                children: \"Iterable[str]\"\n              })]\n            })]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(_components.strong, {\n                children: \"RETURNS\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"The \", _jsx(InlineCode, {\n                children: \"Transformer\"\n              }), \" object. \", _jsx(_components.del, {\n                children: \"Transformer\"\n              })]\n            })]\n          })]\n        })]\n      })]\n    }), \"\\n\", _jsxs(_components.section, {\n      id: \"section-serialization-fields\",\n      children: [_jsx(_components.h2, {\n        id: \"serialization-fields\",\n        children: \"Serialization fields \"\n      }), _jsxs(_components.p, {\n        children: [\"During serialization, spaCy will export several data fields used to restore\\ndifferent aspects of the object. If needed, you can exclude them from\\nserialization by passing in the string names via the \", _jsx(InlineCode, {\n          children: \"exclude\"\n        }), \" argument.\"]\n      }), _jsxs(_components.blockquote, {\n        children: [\"\\n\", _jsx(_components.h4, {\n          children: \"Example\"\n        }), \"\\n\", _jsx(_components.pre, {\n          children: _jsx(_components.code, {\n            className: \"language-python\",\n            lang: \"python\",\n            children: \"data = trf.to_disk(\\\"/path\\\", exclude=[\\\"vocab\\\"])\\n\"\n          })\n        }), \"\\n\"]\n      }), _jsxs(_components.table, {\n        children: [_jsx(_components.thead, {\n          children: _jsxs(_components.tr, {\n            children: [_jsx(_components.th, {\n              children: \"Name\"\n            }), _jsx(_components.th, {\n              children: \"Description\"\n            })]\n          })\n        }), _jsxs(_components.tbody, {\n          children: [_jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"vocab\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"The shared \", _jsx(_components.a, {\n                href: \"/api/vocab\",\n                children: _jsx(InlineCode, {\n                  children: \"Vocab\"\n                })\n              }), \".\"]\n            })]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"cfg\"\n              })\n            }), _jsx(_components.td, {\n              children: \"The config file. You usually don’t want to exclude this.\"\n            })]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"model\"\n              })\n            }), _jsx(_components.td, {\n              children: \"The binary model data. You usually don’t want to exclude this.\"\n            })]\n          })]\n        })]\n      })]\n    }), \"\\n\", _jsxs(_components.section, {\n      id: \"section-transformerdata\",\n      children: [_jsx(_components.h2, {\n        id: \"transformerdata\",\n        tag: \"dataclass\",\n        children: \"TransformerData \"\n      }), _jsxs(_components.p, {\n        children: [\"Transformer tokens and outputs for one \", _jsx(InlineCode, {\n          children: \"Doc\"\n        }), \" object. The transformer models\\nreturn tensors that refer to a whole padded batch of documents. These tensors\\nare wrapped into the\\n\", _jsx(_components.a, {\n          href: \"/api/transformer#fulltransformerbatch\",\n          children: \"FullTransformerBatch\"\n        }), \" object. The\\n\", _jsx(InlineCode, {\n          children: \"FullTransformerBatch\"\n        }), \" then splits out the per-document data, which is handled\\nby this class. Instances of this class are typically assigned to the\\n\", _jsx(_components.a, {\n          href: \"/api/transformer#assigned-attributes\",\n          children: _jsx(InlineCode, {\n            children: \"Doc._.trf_data\"\n          })\n        }), \" extension attribute.\"]\n      }), _jsxs(_components.table, {\n        children: [_jsx(_components.thead, {\n          children: _jsxs(_components.tr, {\n            children: [_jsx(_components.th, {\n              children: \"Name\"\n            }), _jsx(_components.th, {\n              children: \"Description\"\n            })]\n          })\n        }), _jsxs(_components.tbody, {\n          children: [_jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"tokens\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"A slice of the tokens data produced by the tokenizer. This may have several fields, including the token IDs, the texts and the attention mask. See the \", _jsx(_components.a, {\n                href: \"https://huggingface.co/transformers/main_classes/tokenizer.html#transformers.BatchEncoding\",\n                children: _jsx(InlineCode, {\n                  children: \"transformers.BatchEncoding\"\n                })\n              }), \" object for details. \", _jsx(_components.del, {\n                children: \"dict\"\n              })]\n            })]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"model_output\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"The model output from the transformer model, determined by the model and transformer config. New in \", _jsx(InlineCode, {\n                children: \"spacy-transformers\"\n              }), \" v1.1.0. \", _jsx(_components.del, {\n                children: \"transformers.file_utils.ModelOutput\"\n              })]\n            })]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"tensors\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"The \", _jsx(InlineCode, {\n                children: \"model_output\"\n              }), \" in the earlier \", _jsx(InlineCode, {\n                children: \"transformers\"\n              }), \" tuple format converted using \", _jsx(_components.a, {\n                href: \"https://huggingface.co/transformers/main_classes/output.html#transformers.file_utils.ModelOutput.to_tuple\",\n                children: _jsx(InlineCode, {\n                  children: \"ModelOutput.to_tuple()\"\n                })\n              }), \". Returns \", _jsx(InlineCode, {\n                children: \"Tuple\"\n              }), \" instead of \", _jsx(InlineCode, {\n                children: \"List\"\n              }), \" as of \", _jsx(InlineCode, {\n                children: \"spacy-transformers\"\n              }), \" v1.1.0. \", _jsx(_components.del, {\n                children: \"Tuple[Union[FloatsXd, List[FloatsXd]]]\"\n              })]\n            })]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"align\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"Alignment from the \", _jsx(InlineCode, {\n                children: \"Doc\"\n              }), \"’s tokenization to the wordpieces. This is a ragged array, where \", _jsx(InlineCode, {\n                children: \"align.lengths[i]\"\n              }), \" indicates the number of wordpiece tokens that token \", _jsx(InlineCode, {\n                children: \"i\"\n              }), \" aligns against. The actual indices are provided at \", _jsx(InlineCode, {\n                children: \"align[i].dataXd\"\n              }), \". \", _jsx(_components.del, {\n                children: \"Ragged\"\n              })]\n            })]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"width\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"The width of the last hidden layer. \", _jsx(_components.del, {\n                children: \"int\"\n              })]\n            })]\n          })]\n        })]\n      }), _jsx(_components.h3, {\n        id: \"transformerdata-emoty\",\n        tag: \"classmethod\",\n        children: \"TransformerData.empty \"\n      }), _jsxs(_components.p, {\n        children: [\"Create an empty \", _jsx(InlineCode, {\n          children: \"TransformerData\"\n        }), \" container.\"]\n      }), _jsxs(_components.table, {\n        children: [_jsx(_components.thead, {\n          children: _jsxs(_components.tr, {\n            children: [_jsx(_components.th, {\n              children: \"Name\"\n            }), _jsx(_components.th, {\n              children: \"Description\"\n            })]\n          })\n        }), _jsx(_components.tbody, {\n          children: _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(_components.strong, {\n                children: \"RETURNS\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"The container. \", _jsx(_components.del, {\n                children: \"TransformerData\"\n              })]\n            })]\n          })\n        })]\n      }), _jsx(Accordion, {\n        title: \"Previous versions of TransformerData\",\n        spaced: true,\n        children: _jsxs(_components.p, {\n          children: [\"In \", _jsx(InlineCode, {\n            children: \"spacy-transformers\"\n          }), \" v1.0, the model output is stored in\\n\", _jsx(InlineCode, {\n            children: \"TransformerData.tensors\"\n          }), \" as \", _jsx(InlineCode, {\n            children: \"List[Union[FloatsXd]]\"\n          }), \" and only includes the\\nactivations for the \", _jsx(InlineCode, {\n            children: \"Doc\"\n          }), \" from the transformer. Usually the last tensor that is\\n3-dimensional will be the most important, as that will provide the final hidden\\nstate. Generally activations that are 2-dimensional will be attention weights.\\nDetails of this variable will differ depending on the underlying transformer\\nmodel.\"]\n        })\n      })]\n    }), \"\\n\", _jsxs(_components.section, {\n      id: \"section-fulltransformerbatch\",\n      children: [_jsx(_components.h2, {\n        id: \"fulltransformerbatch\",\n        tag: \"dataclass\",\n        children: \"FullTransformerBatch \"\n      }), _jsxs(_components.p, {\n        children: [\"Holds a batch of input and output objects for a transformer model. The data can\\nthen be split to a list of \", _jsx(_components.a, {\n          href: \"/api/transformer#transformerdata\",\n          children: _jsx(InlineCode, {\n            children: \"TransformerData\"\n          })\n        }), \"\\nobjects to associate the outputs to each \", _jsx(_components.a, {\n          href: \"/api/doc\",\n          children: _jsx(InlineCode, {\n            children: \"Doc\"\n          })\n        }), \" in the batch.\"]\n      }), _jsxs(_components.table, {\n        children: [_jsx(_components.thead, {\n          children: _jsxs(_components.tr, {\n            children: [_jsx(_components.th, {\n              children: \"Name\"\n            }), _jsx(_components.th, {\n              children: \"Description\"\n            })]\n          })\n        }), _jsxs(_components.tbody, {\n          children: [_jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"spans\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"The batch of input spans. The outer list refers to the Doc objects in the batch, and the inner list are the spans for that \", _jsx(InlineCode, {\n                children: \"Doc\"\n              }), \". Note that spans are allowed to overlap or exclude tokens, but each \", _jsx(InlineCode, {\n                children: \"Span\"\n              }), \" can only refer to one \", _jsx(InlineCode, {\n                children: \"Doc\"\n              }), \" (by definition). This means that within a \", _jsx(InlineCode, {\n                children: \"Doc\"\n              }), \", the regions of the output tensors that correspond to each \", _jsx(InlineCode, {\n                children: \"Span\"\n              }), \" may overlap or have gaps, but for each \", _jsx(InlineCode, {\n                children: \"Doc\"\n              }), \", there is a non-overlapping contiguous slice of the outputs. \", _jsx(_components.del, {\n                children: \"List[List[Span]]\"\n              })]\n            })]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"tokens\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"The output of the tokenizer. \", _jsx(_components.del, {\n                children: \"transformers.BatchEncoding\"\n              })]\n            })]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"model_output\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"The model output from the transformer model, determined by the model and transformer config. New in \", _jsx(InlineCode, {\n                children: \"spacy-transformers\"\n              }), \" v1.1.0. \", _jsx(_components.del, {\n                children: \"transformers.file_utils.ModelOutput\"\n              })]\n            })]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"tensors\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"The \", _jsx(InlineCode, {\n                children: \"model_output\"\n              }), \" in the earlier \", _jsx(InlineCode, {\n                children: \"transformers\"\n              }), \" tuple format converted using \", _jsx(_components.a, {\n                href: \"https://huggingface.co/transformers/main_classes/output.html#transformers.file_utils.ModelOutput.to_tuple\",\n                children: _jsx(InlineCode, {\n                  children: \"ModelOutput.to_tuple()\"\n                })\n              }), \". Returns \", _jsx(InlineCode, {\n                children: \"Tuple\"\n              }), \" instead of \", _jsx(InlineCode, {\n                children: \"List\"\n              }), \" as of \", _jsx(InlineCode, {\n                children: \"spacy-transformers\"\n              }), \" v1.1.0. \", _jsx(_components.del, {\n                children: \"Tuple[Union[torch.Tensor, Tuple[torch.Tensor]]]\"\n              })]\n            })]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"align\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"Alignment from the spaCy tokenization to the wordpieces. This is a ragged array, where \", _jsx(InlineCode, {\n                children: \"align.lengths[i]\"\n              }), \" indicates the number of wordpiece tokens that token \", _jsx(InlineCode, {\n                children: \"i\"\n              }), \" aligns against. The actual indices are provided at \", _jsx(InlineCode, {\n                children: \"align[i].dataXd\"\n              }), \". \", _jsx(_components.del, {\n                children: \"Ragged\"\n              })]\n            })]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"doc_data\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"The outputs, split per \", _jsx(InlineCode, {\n                children: \"Doc\"\n              }), \" object. \", _jsx(_components.del, {\n                children: \"List[TransformerData]\"\n              })]\n            })]\n          })]\n        })]\n      }), _jsx(_components.h3, {\n        id: \"fulltransformerbatch-unsplit_by_doc\",\n        tag: \"method\",\n        children: \"FullTransformerBatch.unsplit_by_doc \"\n      }), _jsxs(_components.p, {\n        children: [\"Return a new \", _jsx(InlineCode, {\n          children: \"FullTransformerBatch\"\n        }), \" from a split batch of activations, using the\\ncurrent object’s spans, tokens and alignment. This is used during the backward\\npass, in order to construct the gradients to pass back into the transformer\\nmodel.\"]\n      }), _jsxs(_components.table, {\n        children: [_jsx(_components.thead, {\n          children: _jsxs(_components.tr, {\n            children: [_jsx(_components.th, {\n              children: \"Name\"\n            }), _jsx(_components.th, {\n              children: \"Description\"\n            })]\n          })\n        }), _jsxs(_components.tbody, {\n          children: [_jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"arrays\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"The split batch of activations. \", _jsx(_components.del, {\n                children: \"List[List[Floats3d]]\"\n              })]\n            })]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(_components.strong, {\n                children: \"RETURNS\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"The transformer batch. \", _jsx(_components.del, {\n                children: \"FullTransformerBatch\"\n              })]\n            })]\n          })]\n        })]\n      }), _jsx(_components.h3, {\n        id: \"fulltransformerbatch-split_by_doc\",\n        tag: \"method\",\n        children: \"FullTransformerBatch.split_by_doc \"\n      }), _jsxs(_components.p, {\n        children: [\"Split a \", _jsx(InlineCode, {\n          children: \"TransformerData\"\n        }), \" object that represents a batch into a list with one\\n\", _jsx(InlineCode, {\n          children: \"TransformerData\"\n        }), \" per \", _jsx(InlineCode, {\n          children: \"Doc\"\n        }), \".\"]\n      }), _jsxs(_components.table, {\n        children: [_jsx(_components.thead, {\n          children: _jsxs(_components.tr, {\n            children: [_jsx(_components.th, {\n              children: \"Name\"\n            }), _jsx(_components.th, {\n              children: \"Description\"\n            })]\n          })\n        }), _jsx(_components.tbody, {\n          children: _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(_components.strong, {\n                children: \"RETURNS\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"The split batch. \", _jsx(_components.del, {\n                children: \"List[TransformerData]\"\n              })]\n            })]\n          })\n        })]\n      }), _jsx(Accordion, {\n        title: \"Previous versions of FullTransformerBatch\",\n        spaced: true,\n        children: _jsxs(_components.p, {\n          children: [\"In \", _jsx(InlineCode, {\n            children: \"spacy-transformers\"\n          }), \" v1.0, the model output is stored in\\n\", _jsx(InlineCode, {\n            children: \"FullTransformerBatch.tensors\"\n          }), \" as \", _jsx(InlineCode, {\n            children: \"List[torch.Tensor]\"\n          }), \".\"]\n        })\n      })]\n    }), \"\\n\", _jsxs(_components.section, {\n      id: \"section-span_getters\",\n      children: [_jsx(_components.h2, {\n        id: \"span_getters\",\n        source: \"github.com/explosion/spacy-transformers/blob/master/spacy_transformers/span_getters.py\",\n        children: \"Span getters \"\n      }), _jsxs(_components.p, {\n        children: [\"Span getters are functions that take a batch of \", _jsx(_components.a, {\n          href: \"/api/doc\",\n          children: _jsx(InlineCode, {\n            children: \"Doc\"\n          })\n        }), \" objects and\\nreturn a lists of \", _jsx(_components.a, {\n          href: \"/api/span\",\n          children: _jsx(InlineCode, {\n            children: \"Span\"\n          })\n        }), \" objects for each doc to be processed by\\nthe transformer. This is used to manage long documents by cutting them into\\nsmaller sequences before running the transformer. The spans are allowed to\\noverlap, and you can also omit sections of the \", _jsx(InlineCode, {\n          children: \"Doc\"\n        }), \" if they are not relevant.\"]\n      }), _jsxs(_components.p, {\n        children: [\"Span getters can be referenced in the \", _jsx(InlineCode, {\n          children: \"[components.transformer.model.get_spans]\"\n        }), \"\\nblock of the config to customize the sequences processed by the transformer. You\\ncan also register\\n\", _jsx(_components.a, {\n          href: \"/usage/embeddings-transformers#transformers-training-custom-settings\",\n          children: \"custom span getters\"\n        }), \"\\nusing the \", _jsx(InlineCode, {\n          children: \"@spacy.registry.span_getters\"\n        }), \" decorator.\"]\n      }), _jsxs(_components.blockquote, {\n        children: [\"\\n\", _jsx(_components.h4, {\n          children: \"Example\"\n        }), \"\\n\", _jsx(_components.pre, {\n          children: _jsx(_components.code, {\n            className: \"language-python\",\n            lang: \"python\",\n            children: \"@spacy.registry.span_getters(\\\"custom_sent_spans\\\")\\ndef configure_get_sent_spans() -\u003e Callable:\\n    def get_sent_spans(docs: Iterable[Doc]) -\u003e List[List[Span]]:\\n        return [list(doc.sents) for doc in docs]\\n\\n    return get_sent_spans\\n\"\n          })\n        }), \"\\n\"]\n      }), _jsxs(_components.table, {\n        children: [_jsx(_components.thead, {\n          children: _jsxs(_components.tr, {\n            children: [_jsx(_components.th, {\n              children: \"Name\"\n            }), _jsx(_components.th, {\n              children: \"Description\"\n            })]\n          })\n        }), _jsxs(_components.tbody, {\n          children: [_jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"docs\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"A batch of \", _jsx(InlineCode, {\n                children: \"Doc\"\n              }), \" objects. \", _jsx(_components.del, {\n                children: \"Iterable[Doc]\"\n              })]\n            })]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(_components.strong, {\n                children: \"RETURNS\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"The spans to process by the transformer. \", _jsx(_components.del, {\n                children: \"List[List[Span]]\"\n              })]\n            })]\n          })]\n        })]\n      }), _jsx(_components.h3, {\n        id: \"doc_spans\",\n        tag: \"registered function\",\n        children: \"doc_spans.v1 \"\n      }), _jsxs(_components.blockquote, {\n        children: [\"\\n\", _jsx(_components.h4, {\n          children: \"Example config\"\n        }), \"\\n\", _jsx(_components.pre, {\n          children: _jsx(_components.code, {\n            className: \"language-ini\",\n            lang: \"ini\",\n            children: \"[transformer.model.get_spans]\\n@span_getters = \\\"spacy-transformers.doc_spans.v1\\\"\\n\"\n          })\n        }), \"\\n\"]\n      }), _jsxs(_components.p, {\n        children: [\"Create a span getter that uses the whole document as its spans. This is the best\\napproach if your \", _jsx(_components.a, {\n          href: \"/api/doc\",\n          children: _jsx(InlineCode, {\n            children: \"Doc\"\n          })\n        }), \" objects already refer to relatively short\\ntexts.\"]\n      }), _jsx(_components.h3, {\n        id: \"sent_spans\",\n        tag: \"registered function\",\n        children: \"sent_spans.v1 \"\n      }), _jsxs(_components.blockquote, {\n        children: [\"\\n\", _jsx(_components.h4, {\n          children: \"Example config\"\n        }), \"\\n\", _jsx(_components.pre, {\n          children: _jsx(_components.code, {\n            className: \"language-ini\",\n            lang: \"ini\",\n            children: \"[transformer.model.get_spans]\\n@span_getters = \\\"spacy-transformers.sent_spans.v1\\\"\\n\"\n          })\n        }), \"\\n\"]\n      }), _jsxs(_components.p, {\n        children: [\"Create a span getter that uses sentence boundary markers to extract the spans.\\nThis requires sentence boundaries to be set (e.g. by the\\n\", _jsx(_components.a, {\n          href: \"/api/sentencizer\",\n          children: _jsx(InlineCode, {\n            children: \"Sentencizer\"\n          })\n        }), \"), and may result in somewhat uneven batches,\\ndepending on the sentence lengths. However, it does provide the transformer with\\nmore meaningful windows to attend over.\"]\n      }), _jsxs(_components.p, {\n        children: [\"To set sentence boundaries with the \", _jsx(InlineCode, {\n          children: \"sentencizer\"\n        }), \" during training, add a\\n\", _jsx(InlineCode, {\n          children: \"sentencizer\"\n        }), \" to the beginning of the pipeline and include it in\\n\", _jsx(_components.a, {\n          href: \"/usage/training#annotating-components\",\n          children: _jsx(InlineCode, {\n            children: \"[training.annotating_components]\"\n          })\n        }), \" to\\nhave it set the sentence boundaries before the \", _jsx(InlineCode, {\n          children: \"transformer\"\n        }), \" component runs.\"]\n      }), _jsx(_components.h3, {\n        id: \"strided_spans\",\n        tag: \"registered function\",\n        children: \"strided_spans.v1 \"\n      }), _jsxs(_components.blockquote, {\n        children: [\"\\n\", _jsx(_components.h4, {\n          children: \"Example config\"\n        }), \"\\n\", _jsx(_components.pre, {\n          children: _jsx(_components.code, {\n            className: \"language-ini\",\n            lang: \"ini\",\n            children: \"[transformer.model.get_spans]\\n@span_getters = \\\"spacy-transformers.strided_spans.v1\\\"\\nwindow = 128\\nstride = 96\\n\"\n          })\n        }), \"\\n\"]\n      }), _jsxs(_components.p, {\n        children: [\"Create a span getter for strided spans. If you set the \", _jsx(InlineCode, {\n          children: \"window\"\n        }), \" and \", _jsx(InlineCode, {\n          children: \"stride\"\n        }), \" to\\nthe same value, the spans will cover each token once. Setting \", _jsx(InlineCode, {\n          children: \"stride\"\n        }), \" lower\\nthan \", _jsx(InlineCode, {\n          children: \"window\"\n        }), \" will allow for an overlap, so that some tokens are counted twice.\\nThis can be desirable, because it allows all tokens to have both a left and\\nright context.\"]\n      }), _jsxs(_components.table, {\n        children: [_jsx(_components.thead, {\n          children: _jsxs(_components.tr, {\n            children: [_jsx(_components.th, {\n              children: \"Name\"\n            }), _jsx(_components.th, {\n              children: \"Description\"\n            })]\n          })\n        }), _jsxs(_components.tbody, {\n          children: [_jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"window\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"The window size. \", _jsx(_components.del, {\n                children: \"int\"\n              })]\n            })]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"stride\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"The stride size. \", _jsx(_components.del, {\n                children: \"int\"\n              })]\n            })]\n          })]\n        })]\n      })]\n    }), \"\\n\", _jsxs(_components.section, {\n      id: \"section-annotation_setters\",\n      children: [_jsx(_components.h2, {\n        id: \"annotation_setters\",\n        tag: \"registered functions\",\n        source: \"github.com/explosion/spacy-transformers/blob/master/spacy_transformers/annotation_setters.py\",\n        children: \"Annotation setters \"\n      }), _jsxs(_components.p, {\n        children: [\"Annotation setters are functions that take a batch of \", _jsx(InlineCode, {\n          children: \"Doc\"\n        }), \" objects and a\\n\", _jsx(_components.a, {\n          href: \"/api/transformer#fulltransformerbatch\",\n          children: _jsx(InlineCode, {\n            children: \"FullTransformerBatch\"\n          })\n        }), \" and can set\\nadditional annotations on the \", _jsx(InlineCode, {\n          children: \"Doc\"\n        }), \", e.g. to set custom or built-in attributes.\\nYou can register custom annotation setters using the\\n\", _jsx(InlineCode, {\n          children: \"@registry.annotation_setters\"\n        }), \" decorator.\"]\n      }), _jsxs(_components.blockquote, {\n        children: [\"\\n\", _jsx(_components.h4, {\n          children: \"Example\"\n        }), \"\\n\", _jsx(_components.pre, {\n          children: _jsx(_components.code, {\n            className: \"language-python\",\n            lang: \"python\",\n            children: \"@registry.annotation_setters(\\\"spacy-transformers.null_annotation_setter.v1\\\")\\ndef configure_null_annotation_setter() -\u003e Callable:\\n    def setter(docs: List[Doc], trf_data: FullTransformerBatch) -\u003e None:\\n        pass\\n\\n    return setter\\n\"\n          })\n        }), \"\\n\"]\n      }), _jsxs(_components.table, {\n        children: [_jsx(_components.thead, {\n          children: _jsxs(_components.tr, {\n            children: [_jsx(_components.th, {\n              children: \"Name\"\n            }), _jsx(_components.th, {\n              children: \"Description\"\n            })]\n          })\n        }), _jsxs(_components.tbody, {\n          children: [_jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"docs\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"A batch of \", _jsx(InlineCode, {\n                children: \"Doc\"\n              }), \" objects. \", _jsx(_components.del, {\n                children: \"List[Doc]\"\n              })]\n            })]\n          }), _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"trf_data\"\n              })\n            }), _jsxs(_components.td, {\n              children: [\"The transformers data for the batch. \", _jsx(_components.del, {\n                children: \"FullTransformerBatch\"\n              })]\n            })]\n          })]\n        })]\n      }), _jsx(_components.p, {\n        children: \"The following built-in functions are available:\"\n      }), _jsxs(_components.table, {\n        children: [_jsx(_components.thead, {\n          children: _jsxs(_components.tr, {\n            children: [_jsx(_components.th, {\n              children: \"Name\"\n            }), _jsx(_components.th, {\n              children: \"Description\"\n            })]\n          })\n        }), _jsx(_components.tbody, {\n          children: _jsxs(_components.tr, {\n            children: [_jsx(_components.td, {\n              children: _jsx(InlineCode, {\n                children: \"spacy-transformers.null_annotation_setter.v1\"\n              })\n            }), _jsx(_components.td, {\n              children: \"Don’t set any additional annotations.\"\n            })]\n          })\n        })]\n      })]\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\nfunction _missingMdxReference(id, component) {\n  throw new Error(\"Expected \" + (component ? \"component\" : \"object\") + \" `\" + id + \"` to be defined: you likely forgot to import, pass, or provide it.\");\n}\n","frontmatter":{"title":"Transformer","teaser":"Pipeline component for multi-task learning with transformer models","tag":"class","source":"github.com/explosion/spacy-transformers/blob/master/spacy_transformers/pipeline_component.py","version":3,"api_base_class":"/api/pipe","api_string_name":"transformer"},"scope":{}},"sectionTitle":"API Documentation","theme":"green","section":"api","apiDetails":{"stringName":"transformer","baseClass":null,"trainable":null},"isIndex":false,"next":null},"__N_SSG":true},"page":"/[...listPathPage]","query":{"listPathPage":["api","transformer"]},"buildId":"2lY2cUyEfZosk4VLgkHb2","isFallback":false,"dynamicIds":[728],"gsp":true,"scriptLoader":[]}</script></body></html>